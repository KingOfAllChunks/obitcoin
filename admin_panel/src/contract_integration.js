class contract_integration{

	constructor(){
		this.accounts = [];
		this.account = "";

		this.contractAbi = [{"constant":true,"inputs":[{"name":"pool","type":"uint16"}],"name":"getPoolData","outputs":[{"name":"","type":"bytes16[3]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"pool","type":"uint16"},{"name":"member","type":"uint16"}],"name":"getPersonBalance","outputs":[{"name":"","type":"uint128[2]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"member","type":"uint16"}],"name":"getMemberAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getContractAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint16"},{"name":"admin","type":"bool"}],"name":"setAdmin","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPools","outputs":[{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"pool","type":"uint16"}],"name":"getPoolParticipants","outputs":[{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pool","type":"uint16"},{"name":"member","type":"uint16"},{"name":"amount","type":"uint128"}],"name":"sendCoins","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPoolCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getMembers","outputs":[{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes16"},{"name":"legalContract","type":"bytes16"},{"name":"financialReports","type":"bytes16"}],"name":"createDebtPool","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"member","type":"uint16"}],"name":"getMemberPermLevel","outputs":[{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pool","type":"uint16"},{"name":"amount","type":"uint128"}],"name":"buyCoins","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes32"},{"name":"adr","type":"address"},{"name":"isAdmin","type":"bool"}],"name":"addMember","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"member","type":"uint16"}],"name":"getMemberName","outputs":[{"name":"","type":"bytes32"}],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"int256"},{"indexed":false,"name":"time","type":"uint256"}],"name":"CoinsTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"uint128"},{"indexed":false,"name":"time","type":"uint256"}],"name":"CoinsPurchase","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"time","type":"uint256"}],"name":"PoolCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"fromAddress","type":"address"},{"indexed":false,"name":"time","type":"uint256"}],"name":"UnauthorizedAccess","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":false,"name":"added","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"AdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":false,"name":"added","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"PersonChanged","type":"event"}];

		this.contractCompiled = '606060405234156200000d57fe5b5b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506001600660006101000a81548161ffff021916908361ffff1602179055506001600660026101000a81548161ffff021916908361ffff1602179055506080604051908101604052807f4f776e65720000000000000000000000000000000000000000000000000000006000191681526020013373ffffffffffffffffffffffffffffffffffffffff16815260200160036003811115620000eb57fe5b81526020016001151581525060016000600660009054906101000a900461ffff1661ffff1661ffff1681526020019081526020016000206000820151816000019060001916905560208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160010160146101000a81548160ff021916908360038111156200019e57fe5b021790555060608201518160010160156101000a81548160ff02191690831515021790555090505060028054806001018281620001dc9190620002c8565b91600052602060002090601091828204019190066002025b600660009054906101000a900461ffff16909190916101000a81548161ffff021916908361ffff16021790555050600660009054906101000a900461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548161ffff021916908361ffff1602179055506006600081819054906101000a900461ffff168092919060010191906101000a81548161ffff021916908361ffff160217905550505b6200032d565b8154818355818115116200030057600f016010900481600f01601090048360005260206000209182019101620002ff919062000305565b5b505050565b6200032a91905b80821115620003265760008160009055506001016200030c565b5090565b90565b612e17806200033d6000396000f300606060405236156100d9576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806305790c08146100db57806316d66b54146101495780631e8de48a146101c457806332a2c5d0146102285780635fd42e4d1461027a578063673a2a1f146102a95780636d8171301461031e5780637c62fc0d146103a55780638eec5d70146103f15780639eab525314610417578063a5f975541461048c578063aa32eecd146104f7578063bf5c82351461053d578063e1669f171461057c578063e5dca9c7146105ca575bfe5b34156100e357fe5b6100fd600480803561ffff1690602001909190505061060a565b6040518082600360200280838360008314610137575b80518252602083111561013757602082019150602081019050602083039250610113565b50505090500191505060405180910390f35b341561015157fe5b610178600480803561ffff1690602001909190803561ffff16906020019091905050610790565b60405180826002602002808383600083146101b2575b8051825260208311156101b25760208201915060208101905060208303925061018e565b50505090500191505060405180910390f35b34156101cc57fe5b6101e6600480803561ffff169060200190919050506108c3565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561023057fe5b610238610943565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b341561028257fe5b6102a7600480803561ffff16906020019091908035151590602001909190505061094c565b005b34156102b157fe5b6102b9610b6c565b604051808060200182810382528381815181526020019150805190602001906020028083836000831461030b575b80518252602083111561030b576020820191506020810190506020830392506102e7565b5050509050019250505060405180910390f35b341561032657fe5b610340600480803561ffff16906020019091905050610bf3565b6040518080602001828103825283818151815260200191508051906020019060200280838360008314610392575b8051825260208311156103925760208201915060208101905060208303925061036e565b5050509050019250505060405180910390f35b34156103ad57fe5b6103ef600480803561ffff1690602001909190803561ffff169060200190919080356fffffffffffffffffffffffffffffffff16906020019091905050610ccf565b005b34156103f957fe5b610401611310565b6040518082815260200191505060405180910390f35b341561041f57fe5b61042761131e565b6040518080602001828103825283818151815260200191508051906020019060200280838360008314610479575b80518252602083111561047957602082019150602081019050602083039250610455565b5050509050019250505060405180910390f35b341561049457fe5b6104f560048080356fffffffffffffffffffffffffffffffff19169060200190919080356fffffffffffffffffffffffffffffffff19169060200190919080356fffffffffffffffffffffffffffffffff19169060200190919050506113a5565b005b34156104ff57fe5b610519600480803561ffff1690602001909190505061188d565b6040518082600381111561052957fe5b60ff16815260200191505060405180910390f35b341561054557fe5b61057a600480803561ffff169060200190919080356fffffffffffffffffffffffffffffffff169060200190919050506118fa565b005b341561058457fe5b6105c860048080356000191690602001909190803573ffffffffffffffffffffffffffffffffffffffff169060200190919080351515906020019091905050612724565b005b34156105d257fe5b6105ec600480803561ffff16906020019091905050612b43565b60405180826000191660001916815260200191505060405180910390f35b610612612ba3565b600360008361ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff16151561064957610000565b606060405190810160405280600360008561ffff1661ffff16815260200190815260200160002060000160009054906101000a9004700100000000000000000000000000000000026fffffffffffffffffffffffffffffffff19166fffffffffffffffffffffffffffffffff19168152602001600360008561ffff1661ffff16815260200190815260200160002060000160109054906101000a9004700100000000000000000000000000000000026fffffffffffffffffffffffffffffffff19166fffffffffffffffffffffffffffffffff19168152602001600360008561ffff1661ffff16815260200190815260200160002060010160009054906101000a9004700100000000000000000000000000000000026fffffffffffffffffffffffffffffffff19166fffffffffffffffffffffffffffffffff191681525090505b919050565b610798612bde565b600360008461ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff1615806107f95750600160008361ffff1661ffff16815260200190815260200160002060010160159054906101000a900460ff16155b1561080357610000565b600360008461ffff1661ffff16815260200190815260200160002060030160008361ffff1661ffff1681526020019081526020016000206002806020026040519081016040528092919082600280156108b5576020028201916000905b82829054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020019060100190602082600f010492830192600103820291508084116108605790505b505050505090505b92915050565b6000600160008361ffff1661ffff16815260200190815260200160002060010160159054906101000a900460ff1615156108fc57610000565b600160008361ffff1661ffff16815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b919050565b60003090505b90565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610a48573373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a3610b68565b600160008361ffff1661ffff16815260200190815260200160002060010160159054906101000a900460ff161515610a7f57610000565b80610a8b576001610a8e565b60025b600160008461ffff1661ffff16815260200190815260200160002060010160146101000a81548160ff02191690836003811115610ac757fe5b02179055508161ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f955f9cd413b1613b572ff1877b25ae515763d2a51d926bd21ba78d8ec4f16c3c834260405180831515151581526020018281526020019250505060405180910390a35b5b5050565b610b74612c18565b6004805480602002602001604051908101604052809291908181526020018280548015610be857602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff1681526020019060020190602082600101049283019260010382029150808411610baf5790505b505050505090505b90565b610bfb612c18565b600360008361ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff161515610c3257610000565b600360008361ffff1661ffff168152602001908152602001600020600201805480602002602001604051908101604052809291908181526020018280548015610cc257602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff1681526020019060020190602082600101049283019260010382029150808411610c895790505b505050505090505b919050565b60026003811115610cdc57fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff166003811115610d6057fe5b1480610dfa575060036003811115610d7457fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff166003811115610df857fe5b145b1561126a576000816fffffffffffffffffffffffffffffffff161480610e495750600360008461ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff16155b80610e7d5750600160008361ffff1661ffff16815260200190815260200160002060010160159054906101000a900460ff16155b15610e8757610000565b600360008461ffff1661ffff16815260200190815260200160002060030160008361ffff1661ffff1681526020019081526020016000206000600281101515610ecc57fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681600360008661ffff1661ffff16815260200190815260200160002060030160008561ffff1661ffff1681526020019081526020016000206000600281101515610f4d57fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff16016fffffffffffffffffffffffffffffffff161015610f9457610000565b6000600360008561ffff1661ffff16815260200190815260200160002060030160008461ffff1661ffff1681526020019081526020016000206000600281101515610fdb57fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff161480156110a257506000600360008561ffff1661ffff16815260200190815260200160002060030160008461ffff1661ffff168152602001908152602001600020600160028110151561106557fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16145b1561110e57600360008461ffff1661ffff16815260200190815260200160002060020180548060010182816110d79190612c2c565b91600052602060002090601091828204019190066002025b84909190916101000a81548161ffff021916908361ffff160217905550505b80600360008561ffff1661ffff16815260200190815260200160002060030160008461ffff1661ffff168152602001908152602001600020600060028110151561115457fe5b600291828204019190066010025b8282829054906101000a90046fffffffffffffffffffffffffffffffff160192506101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055508261ffff168261ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167ff1c63bd1b1f98e9522b0f7544810503e28afe1450e31c0fc5ef84e47c76b9a41846fffffffffffffffffffffffffffffffff1642604051808381526020018281526020019250505060405180910390a45b61130b565b3373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a35b505050565b600060048054905090505b90565b611326612c18565b600280548060200260200160405190810160405280929190818152602001828054801561139a57602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff16815260200190600201906020826001010492830192600103820291508084116113615790505b505050505090505b90565b6113ad612c66565b600260038111156113ba57fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16600381111561143e57fe5b14806114d857506003600381111561145257fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff1660038111156114d657fe5b145b156117e6578381600001906fffffffffffffffffffffffffffffffff191690816fffffffffffffffffffffffffffffffff1916815250508281602001906fffffffffffffffffffffffffffffffff191690816fffffffffffffffffffffffffffffffff1916815250508181604001906fffffffffffffffffffffffffffffffff191690816fffffffffffffffffffffffffffffffff19168152505060018160800190151590811515815250508060036000600660029054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060008201518160000160006101000a8154816fffffffffffffffffffffffffffffffff02191690837001000000000000000000000000000000009004021790555060208201518160000160106101000a8154816fffffffffffffffffffffffffffffffff02191690837001000000000000000000000000000000009004021790555060408201518160010160006101000a8154816fffffffffffffffffffffffffffffffff021916908370010000000000000000000000000000000090040217905550606082015181600201908051906020019061168f929190612cd7565b5060808201518160040160006101000a81548160ff021916908315150217905550905050600480548060010182816116c79190612c2c565b91600052602060002090601091828204019190066002025b600660029054906101000a900461ffff16909190916101000a81548161ffff021916908361ffff16021790555050600660029054906101000a900461ffff1661ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167fc47e69d129b82ba63be79ea96dd6133d44966f2948ecf69c520903ea92c08732426040518082815260200191505060405180910390a36006600281819054906101000a900461ffff168092919060010191906101000a81548161ffff021916908361ffff160217905550505b611887565b3373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a35b50505050565b6000600160008361ffff1661ffff16815260200190815260200160002060010160159054906101000a900460ff1615156118c657610000565b600160008361ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff1690505b919050565b600060006000600060006000600060006002600381111561191757fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16600381111561199b57fe5b1480611a355750600360038111156119af57fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff166003811115611a3357fe5b145b15612677576000896fffffffffffffffffffffffffffffffff161480611a845750600360008b61ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff16155b80611ab057506000600360008c61ffff1661ffff16815260200190815260200160002060020180549050145b15611aba57610000565b60009750600096506000955060009450600094505b600360008b61ffff1661ffff16815260200190815260200160002060020180549050851015611bc757600360008b61ffff1661ffff1681526020019081526020016000206003016000600360008d61ffff1661ffff16815260200190815260200160002060020187815481101515611b4357fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff1661ffff1661ffff1681526020019081526020016000206000600281101515611b8c57fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff16880197505b8480600101955050611acf565b600094506000886fffffffffffffffffffffffffffffffff16111561204f57600094505b600360008b61ffff1661ffff1681526020019081526020016000206002018054905085101561204e57600360008b61ffff1661ffff16815260200190815260200160002060020185815481101515611c3f57fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff169350600360008b61ffff1661ffff16815260200190815260200160002060030160008561ffff1661ffff1681526020019081526020016000206000600281101515611cab57fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff169250600360008b61ffff1661ffff16815260200190815260200160002060030160008561ffff1661ffff1681526020019081526020016000206001600281101515611d1b57fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff169150876fffffffffffffffffffffffffffffffff168984026fffffffffffffffffffffffffffffffff16811515611d7757fe5b049050826fffffffffffffffffffffffffffffffff168184036fffffffffffffffffffffffffffffffff161115611e6b578961ffff168461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167ff1c63bd1b1f98e9522b0f7544810503e28afe1450e31c0fc5ef84e47c76b9a41866fffffffffffffffffffffffffffffffff1660000342604051808381526020018281526020019250505060405180910390a48286019550828201915060009250611f2b565b8961ffff168461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167ff1c63bd1b1f98e9522b0f7544810503e28afe1450e31c0fc5ef84e47c76b9a41846fffffffffffffffffffffffffffffffff1660000342604051808381526020018281526020019250505060405180910390a48083039250808201915080860195505b82600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff1681526020019081526020016000206000600281101515611f7157fe5b600291828204019190066010025b6101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555081600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff1681526020019081526020016000206001600281101515611ff957fe5b600291828204019190066010025b6101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555081870196505b8480600101955050611beb565b5b886fffffffffffffffffffffffffffffffff16866fffffffffffffffffffffffffffffffff161015612263576000876fffffffffffffffffffffffffffffffff16111561226157600094505b600360008b61ffff1661ffff1681526020019081526020016000206002018054905085101561225c57600360008b61ffff1661ffff168152602001908152602001600020600201858154811015156120ef57fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff169350600360008b61ffff1661ffff16815260200190815260200160002060030160008561ffff1661ffff168152602001908152602001600020600160028110151561215b57fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff169150866fffffffffffffffffffffffffffffffff16868a0383026fffffffffffffffffffffffffffffffff168115156121b957fe5b0490508082019150808601955081600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff168152602001908152602001600020600160028110151561220c57fe5b600291828204019190066010025b6101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055505b848060010195505061209b565b612262565b5b5b886fffffffffffffffffffffffffffffffff16866fffffffffffffffffffffffffffffffff16101561258657600360008b61ffff1661ffff1681526020019081526020016000206002016001600360008d61ffff1661ffff16815260200190815260200160002060020180549050038154811015156122de57fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff1693508589036fffffffffffffffffffffffffffffffff16600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff168152602001908152602001600020600060028110151561235f57fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16111561245057858903600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff16815260200190815260200160002060006002811015156123e857fe5b600291828204019190066010025b8282829054906101000a90046fffffffffffffffffffffffffffffffff160392506101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055506124da565b6000600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff168152602001908152602001600020600060028110151561249757fe5b600291828204019190066010025b6101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055505b858903600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff168152602001908152602001600020600160028110151561252257fe5b600291828204019190066010025b8282829054906101000a90046fffffffffffffffffffffffffffffffff160192506101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055505b886fffffffffffffffffffffffffffffffff16866fffffffffffffffffffffffffffffffff1611156125b757610000565b8961ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167fe28c0d9501fa020856fc059bfad5015436c1dbeeb9b95c12af58b94ab5273bd1884260405180836fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a35b612718565b3373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a35b50505050505050505050565b6002600381111561273157fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff1660038111156127b557fe5b148061284f5750600360038111156127c957fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16600381111561284d57fe5b145b15612a9d5760008273ffffffffffffffffffffffffffffffffffffffff16141561287857610000565b608060405190810160405280846000191681526020018373ffffffffffffffffffffffffffffffffffffffff168152602001826128b65760016128b9565b60025b60038111156128c457fe5b81526020016001151581525060016000600660009054906101000a900461ffff1661ffff1661ffff1681526020019081526020016000206000820151816000019060001916905560208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160010160146101000a81548160ff0219169083600381111561297657fe5b021790555060608201518160010160156101000a81548160ff021916908315150217905550905050600660009054906101000a900461ffff16600560008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548161ffff021916908361ffff16021790555060028054806001018281612a1c9190612c2c565b91600052602060002090601091828204019190066002025b600660009054906101000a900461ffff16909190916101000a81548161ffff021916908361ffff160217905550506006600081819054906101000a900461ffff168092919060010191906101000a81548161ffff021916908361ffff160217905550505b612b3e565b3373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a35b505050565b6000600160008361ffff1661ffff16815260200190815260200160002060010160159054906101000a900460ff161515612b7c57610000565b600160008361ffff1661ffff1681526020019081526020016000206000015490505b919050565b6060604051908101604052806003905b60006fffffffffffffffffffffffffffffffff1916815260200190600190039081612bb35790505090565b6040604051908101604052806002905b60006fffffffffffffffffffffffffffffffff16815260200190600190039081612bee5790505090565b602060405190810160405280600081525090565b815481835581811511612c6157600f016010900481600f01601090048360005260206000209182019101612c609190612d81565b5b505050565b60a06040519081016040528060006fffffffffffffffffffffffffffffffff1916815260200160006fffffffffffffffffffffffffffffffff1916815260200160006fffffffffffffffffffffffffffffffff19168152602001612cc8612da6565b81526020016000151581525090565b82805482825590600052602060002090600f01601090048101928215612d705791602002820160005b83821115612d4057835183826101000a81548161ffff021916908361ffff1602179055509260200192600201602081600101049283019260010302612d00565b8015612d6e5782816101000a81549061ffff0219169055600201602081600101049283019260010302612d40565b505b509050612d7d9190612dba565b5090565b612da391905b80821115612d9f576000816000905550600101612d87565b5090565b90565b602060405190810160405280600081525090565b612de891905b80821115612de457600081816101000a81549061ffff021916905550600101612dc0565b5090565b905600a165627a7a723058203b0d59a0dc919c5cac9849fe33455f0fd3c498d12a96257851d4429b4fbf6bfc0029';

		this.contractGas = '4700000';

		this.init();
		this.self = this;
	}

	init(){
		var self = this;
		window.onload = function() {
			while(!web3);
			web3.eth.getAccounts(function(err, accs) {
				if (err != null) {
				alert("There was an error fetching your accounts.");
				return;
				}

				if (accs.length == 0) {
				alert("Couldn't get any accounts! Make sure your Ethereum client is configured correctly.");
				return;
			}
			
				self.accounts = accs;
				self.account = self.accounts[0];
				
			});
		}
	}

	deployNewContract() {
		
		var obitcoinContract = web3.eth.contract(this.contractAbi);
		this.Obitcoin = obitcoinContract.new(
		{
			from: web3.eth.accounts[0], 
			data: this.contractCompiled, 
			gas: this.contractGas
		}, function (e, contract){
			console.log(e, contract);
			if (typeof contract.address !== 'undefined') {
				console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
				
				//this.startListeningForEvents();
			}
		})
	}

	connectToContract(address) {
		
		var obitcoinContract = web3.eth.contract(this.contractAbi);
		
		this.Obitcoin = obitcoinContract.at(address);
		
		var self = this;

		this.Obitcoin.getContractAddress.call({from: this.account}, function(error, result){
			if(!error)
				if(result==address){
					console.log("Connection successful");
					
					//self.startListeningForEvents();
				} else {
					console.log("Invalid address!");
				}
			else
				console.error(error);
		});
	}

	addMember(name, address, isAdmin){
		this.Obitcoin.addMember(name, address, isAdmin, {from: this.account}, function(err, result){
			if(!error)
				console.log(result);
			else
				console.error(error);
		});
	}

	setAdmin(member, admin) {
		
		this.Obitcoin.setAdmin(member, admin, {from: this.account}, function(error, result){
			if(!error)
				console.log(result);
			else
				console.error(error);
		});
	}

	createDebtPool(name, legalContract, financialReports) {
		this.Obitcoin.createDebtPool(name, legalContract, financialReports, {from: this.account}, function(error, result){
			if(!error)
				console.log(result);
			else
				console.error(error);
		});
	}

	getPools(callback){
		this.Obitcoin.getPools.call({from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getPoolData(pool, callback){
		var self = this;
		this.Obitcoin.getPoolData.call(pool, {from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(item => data.push(self.hex2a(item)));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getPoolParticipants(pool, callback) {
		this.Obitcoin.getPoolParticipants.call(pool, {from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getMembers(callback){
		this.Obitcoin.getMembers.call({from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getMemberBalance(pool, member, callback){
		this.Obitcoin.getPersonBalance.call(pool, member, {from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data, member);
			}
			else
				console.error(error);
		});
	}

	getMemberName(member, callback){
		var self = this;
		this.Obitcoin.getMemberName.call(member, {from: this.account}, function(error, result){
			if(!error){
				callback(self.hex2a(result));
			}
			else
				console.error(error);
		});
	}
		
	getMemberAddress(member, callback){
		this.Obitcoin.getMemberAddress.call(member, {from: this.account}, function(error, result){
			if(!error){
				callback(result);
			}
			else
				console.error(error);
		});
	}

	getMemberPermLevel(member, callback){
		this.Obitcoin.getMemberPermLevel.call(member, {from: this.account}, function(error, result){
			if(!error)
				callback(result.valueOf());
			else
				console.error(error);
		});
	}

	sendCoins(pool, member, amount){
		this.Obitcoin.sendCoins(pool, member, amount, {from: this.account}, function(error, result){
			if(!error)
				console.log(result)
			else
				console.error(error);
		});
	}

	buyCoins(pool, amount){
		this.Obitcoin.buyCoins(pool, amount, {from: this.account}, function(error, result){
			if(!error)
				console.log(result)
			else
				console.error(error);
		});
	}

	getWholeMembers(callback){
		var members = [];
		var self = this;
		this.getMembers(function(data){
			for(var i = 0; i<data.length; i++){
				self.getWholeMember(data[i], function(member){
					members.push(member);
					//console.log(member);

					if(members.length == data.length){
						callback(members);
					}
				});

			}
		});
	}

	getWholeMember(id, callback){
		var member = {};
		member.id = Number(id);

		this.getMemberName(id, function(result){
			member.name = result;

			if(member.name != undefined && member.address != undefined && member.permissionLevel != undefined) callback(member);
		});
		this.getMemberAddress(id, function(result){
			member.address = result;

			if(member.name != undefined && member.address != undefined && member.permissionLevel != undefined) callback(member);
		});
		this.getMemberPermLevel(id, function(result){
			member.permissionLevel = Number(result);

			if(member.name != undefined && member.address != undefined && member.permissionLevel != undefined) callback(member);
		});
	}

	getWholePools(callback){
		var pools = [];
		var self = this;
		this.getPools(function(data){
			for(var i = 0; i<data.length; i++){
				self.getWholePool(data[i], function(pool){
					pools.push(pool);
					console.log(pool);

					if(pools.length == data.length){
						callback(pools);
					}
				});

			}
		});
	}

	getWholePool(id, callback){
		var self = this;

		var pool = {};
		pool.id = Number(id);
		var stage1=false, stage2=false;

		pool.tokens = new Map();
		pool.slices = new Map();

		this.getPoolData(id, function(result){
			pool.name = result[0];
			pool.legalContract = result[1];
			pool.financialReports = result[2];

			stage1=true;

			if(stage1 && stage2) callback(pool);
		});

		this.getPoolParticipants(id, function(result){
			pool.members = [];
			result.forEach(item => pool.members.push(Number(item)));

			for(var i=0; i<result.length; i++){
				self.getMemberBalance(id, result[i], function(data, member){
					pool.tokens[Number(member)] = Number(data[0]);
					pool.slices[Number(member)] = Number(data[1]);

					if(result[result.length-1]==member){
						stage2=true;

						if(stage1 && stage2) callback(pool);
					}
				});
			}
		});
	}

	startListeningForEvents(callback){
		var events = this.Obitcoin.allEvents({fromBlock: 564201});
		events.watch(function(err, event) {
			if (err) {
				console.log(err)
				return;
			}
			
			callback(event);

			console.log(event);
		});

		/*var coinsTransferEvent = this.Obitcoin.CoinsTransfer({}, {fromBlock: 0});
		coinsTransferEvent.watch(function(err, result) {
			if (err) {
				console.log(err)
				return;
			}
			console.log("["+result.args.time.valueOf()+"] sent "+result.args.amount.valueOf()+" from "+result.args.from+" to "+result.args.to);
		});
		
		var coinsPurchaseEvent = this.Obitcoin.CoinsPurchase({}, {fromBlock: 0});
		coinsPurchaseEvent.watch(function(err, result) {
			if (err) {
				console.log(err)
				return;
			}
			console.log("["+result.args.time.valueOf()+"] bought "+result.args.amount.valueOf()+" from "+result.args.from+" to "+result.args.poolIndex+" debt pool");
		});
		
		var poolCreatedEvent = this.Obitcoin.PoolCreated({}, {fromBlock: 0});
		poolCreatedEvent.watch(function(err,result) {
			if(err) {
				console.log(err);
				return;
			}
			console.log("["+result.args.time.valueOf()+"] created pool with index "+result.args.index.valueOf());
		});
		
		var unauthorizedAccessEvent = this.Obitcoin.UnauthorizedAccess({}, {fromBlock: 0});
		unauthorizedAccessEvent.watch(function(err,result) {
			if(err) {
				console.log(err);
				return;
			}
			console.log("["+result.args.time.valueOf()+"] Warning! Unauthorized access from "+result.args.from);
		});
		
		var adminChangedEvent = this.Obitcoin.AdminChanged({}, {fromBlock: 0});
		adminChangedEvent.watch(function(err,result) {
			if(err) {
				console.log(err);
				return;
			}
			console.log("["+result.args.time.valueOf()+"]" + (result.args.added ? "Added" : "Removed") + " admin with address "+result.args.person);
		});*/
		
		
	}

	hex2a(hexx) {
		var hex = hexx.toString();//force conversion
		var str = '';
		var int;
		for (var i = 2; i < hex.length; i += 2){
			int = parseInt(hex.substr(i, 2), 16);
			if(int==0) continue;
			str += String.fromCharCode(int);
		}
		return str;
	}

}