class contractintegration{

	constructor(){
		this.accounts = [];
		this.account = "";

		this.contractAbi = [{"constant":true,"inputs":[{"name":"pool","type":"uint16"}],"name":"getMembersBalance","outputs":[{"name":"","type":"uint128[2][]"},{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"pool","type":"uint16"}],"name":"getPoolData","outputs":[{"name":"","type":"bytes16[3]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pools","type":"uint16[]"},{"name":"members","type":"uint16[]"},{"name":"amount","type":"uint128[]"}],"name":"sendTokensBulk","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getContractAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"member","type":"uint16"}],"name":"getMemberDetails","outputs":[{"name":"","type":"bytes32"},{"name":"","type":"address"},{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPublishingBlockNumber","outputs":[{"name":"","type":"uint32"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"member","type":"uint16"},{"name":"name","type":"bytes32"},{"name":"adr","type":"address"},{"name":"isAdmin","type":"bool"}],"name":"updateMember","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint16"},{"name":"admin","type":"bool"}],"name":"setAdmin","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPools","outputs":[{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"pool","type":"uint16"}],"name":"getPoolParticipants","outputs":[{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPoolCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pool","type":"uint16"},{"name":"member","type":"uint16"},{"name":"amount","type":"uint128"}],"name":"sendTokens","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getMembers","outputs":[{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes16"},{"name":"legalContract","type":"bytes16"},{"name":"financialReports","type":"bytes16"}],"name":"createDebtPool","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"pool","type":"uint16"},{"name":"member","type":"uint16"}],"name":"getMemberBalance","outputs":[{"name":"","type":"uint128[2]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pool","type":"uint16"},{"name":"name","type":"bytes16"},{"name":"legalContract","type":"bytes16"},{"name":"financialReports","type":"bytes16"}],"name":"updateDebtPool","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes32"},{"name":"adr","type":"address"},{"name":"isAdmin","type":"bool"}],"name":"addMember","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pool","type":"uint16"},{"name":"amount","type":"uint128"}],"name":"buyTokens","outputs":[],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"int256"},{"indexed":false,"name":"time","type":"uint256"}],"name":"TokenTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"uint128"},{"indexed":false,"name":"time","type":"uint256"}],"name":"SliceTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"uint128"},{"indexed":false,"name":"time","type":"uint256"}],"name":"TokenPurchase","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"added","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"PoolChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"fromAddress","type":"address"},{"indexed":false,"name":"time","type":"uint256"}],"name":"UnauthorizedAccess","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":false,"name":"added","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"AdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":false,"name":"added","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"PersonChanged","type":"event"}];

		this.contractCompiled = '606060405234156200000d57fe5b5b60008054600160a060020a03191633600160a060020a0316908117909155600680546201000067ffffffff00000000199091166401000000004363ffffffff16021761ffff191660011763ffff00001916179055604080516080810182527f4f776e657200000000000000000000000000000000000000000000000000000081526020810192909252810160035b81526001602091820181905260065461ffff16600090815281835260409081902084518155928401519183018054600160a060020a031916600160a060020a039093169290921780835590840151919060a060020a60ff021916740100000000000000000000000000000000000000008360038111156200011957fe5b0217905550606091909101516001918201805491151575010000000000000000000000000000000000000000000260a860020a60ff021990921691909117905560028054909181016200016d8382620001e6565b91600052602060002090601091828204019190066002025b60068054835461ffff6101009490940a848102199091169184160217909255815433600160a060020a03166000908152600560205260409020805491831661ffff199283161790558254908116908216600101909116179055505b62000247565b8154818355818115116200021d57600f016010900481600f016010900483600052602060002091820191016200021d919062000223565b5b505050565b6200024491905b808211156200024057600081556001016200022a565b5090565b90565b6128b380620002576000396000f300606060405236156100e05763ffffffff60e060020a60003504166304a385e581146100e257806305790c08146101bb57806323453e2d1461020f57806332a2c5d0146102d457806338c5e15a14610300578063438a5f131461035257806357091c811461037b5780635fd42e4d146103a8578063673a2a1f146103c65780636d817130146104315780638eec5d70146104a35780639a59b749146104c55780639eab5253146104f0578063a5f975541461055b578063a97bd3fe14610586578063cee11e96146105e2578063e1669f1714610614578063f3fa89df1461063a575bfe5b34156100ea57fe5b6100f961ffff6004351661065f565b6040518080602001806020018381038352858181518152602001915080516000925b818410156101625760208085028401015160408083835b80518252602083111561015257601f199092019160209182019101610132565b505050905001926001019261011b565b868103855287518152875160209182019450818901935002905080838382156101a6575b8051825260208311156101a657601f199092019160209182019101610186565b50505090500194505050505060405180910390f35b34156101c357fe5b6101d261ffff600435166108a5565b604051808260608083835b8051825260208311156101fd57601f1990920191602091820191016101dd565b50505090500191505060405180910390f35b341561021757fe5b6102d2600480803590602001908201803590602001908080602002602001604051908101604052809392919081815260200183836020028082843750506040805187358901803560208181028481018201909552818452989a998901989297509082019550935083925085019084908082843750506040805187358901803560208181028481018201909552818452989a99890198929750908201955093508392508501908490808284375094965061092e95505050505050565b005b34156102dc57fe5b6102e4610a0a565b60408051600160a060020a039092168252519081900360200190f35b341561030857fe5b61031761ffff60043516610a0f565b60408051848152600160a060020a038416602082015290810182600381111561033c57fe5b60ff168152602001935050505060405180910390f35b341561035a57fe5b610362610a7a565b6040805163ffffffff9092168252519081900360200190f35b341561038357fe5b6102d261ffff60043516602435600160a060020a03604435166064351515610a8f565b005b34156103b057fe5b6102d261ffff600435166024351515610cf9565b005b34156103ce57fe5b6103d6610ea1565b604080516020808252835181830152835191928392908301918581019102808383821561041e575b80518252602083111561041e57601f1990920191602091820191016103fe565b5050509050019250505060405180910390f35b341561043957fe5b6103d661ffff60043516610f28565b604080516020808252835181830152835191928392908301918581019102808383821561041e575b80518252602083111561041e57601f1990920191602091820191016103fe565b5050509050019250505060405180910390f35b34156104ab57fe5b6104b3610fe6565b60408051918252519081900360200190f35b34156104cd57fe5b6102d261ffff600435811690602435166001608060020a0360443516610fed565b005b34156104f857fe5b6103d6611388565b604080516020808252835181830152835191928392908301918581019102808383821561041e575b80518252602083111561041e57601f1990920191602091820191016103fe565b5050509050019250505060405180910390f35b341561056357fe5b6102d26001608060020a03196004358116906024358116906044351661140f565b005b341561058e57fe5b6105a361ffff6004358116906024351661163a565b6040805190819083908083835b8051825260208311156101fd57601f1990920191602091820191016101dd565b50505090500191505060405180910390f35b34156105ea57fe5b6102d261ffff600435166001608060020a03196024358116906044358116906064351661171b565b005b341561061c57fe5b6102d2600435600160a060020a036024351660443515156118ce565b005b341561064257fe5b6102d261ffff600435166001608060020a0360243516611ba9565b005b61066761272d565b61066f61272d565b61067761272d565b61ffff841660009081526003602052604081206004015460ff16151561069c57610000565b61ffff8516600090815260036020526040908190206002015490518059106106c15750595b9080825280602002602001820160405280156106f757816020015b6106e4612751565b8152602001906001900390816106dc5790505b509150600090505b61ffff80861660009081526003602052604090206002015490821610156108095761ffff808616600090815260036020819052604082206002810180549190920193851690811061074c57fe5b90600052602060002090601091828204019190066002025b905461ffff6101009290920a900416815260208101919091526040908101600020815180830190925260028282826020028201916000905b82829054906101000a90046001608060020a03166001608060020a031681526020019060100190602082600f0104928301926001038202915080841161079c5790505b5050505050828261ffff168151811015156107f657fe5b602090810290910101525b6001016106ff565b61ffff851660009081526003602090815260409182902060020180548351818402810184019094528084528593919283919083018282801561089257602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff16815260200190600201906020826001010492830192600103820291508084116108595790505b50505050509050935093505b5050915091565b6108ad61277a565b61ffff821660009081526003602052604090206004015460ff1615156108d257610000565b506040805160608101825261ffff831660008181526003602081815285832080546001608060020a0319608060020a8083028216895291829004820281168489015295909452919052600101540216918101919091525b919050565b600082516000148061093f57508151155b8061094957508351155b8061095657508251825114155b8061096357508351835114155b1561096d57610000565b5060005b82518161ffff16108015610989575081518161ffff16105b8015610999575083518161ffff16105b15610a03576109fa848261ffff168151811015156109b357fe5b90602001906020020151848361ffff168151811015156109cf57fe5b90602001906020020151848461ffff168151811015156109eb57fe5b90602001906020020151610fed565b5b600101610971565b5b50505050565b305b90565b61ffff81166000908152600160208190526040822001548190819060a860020a900460ff161515610a3f57610000565b50505061ffff811660009081526001602081905260409091208054910154600160a060020a0381169060a060020a900460ff165b9193909250565b600654640100000000900463ffffffff165b90565b60025b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff166003811115610ad457fe5b1480610b22575060035b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff166003811115610b2057fe5b145b15610cb05761ffff84166000908152600160208190526040909120015460a860020a900460ff161515610b5457610000565b60035b61ffff85166000908152600160208190526040909120015460a060020a900460ff166003811115610b8457fe5b1415610b8f57610000565b61ffff84811660008181526001602081815260408084208084018054600160a060020a03908116875260058552838720805461ffff19908116909a1790558a1680875292862080549098168717909755949093525290859055815473ffffffffffffffffffffffffffffffffffffffff191617905580610c10576001610c13565b60025b61ffff8516600090815260016020819052604090912001805460a060020a60ff02191660a060020a836003811115610c4757fe5b0217905550600160a060020a03331660009081526005602090815260408083205481519384524292840192909252805161ffff808916949316927f7107c2ae9754688147920c7dbf25c81ed808624042d38439123c6da5fe34beb492908290030190a35b610a03565b600160a060020a033316600081815260056020908152604091829020548251428152925161ffff9091169260008051602061286883398151915292908290030190a35b50505050565b60035b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff166003811115610d3e57fe5b14610d8a57600160a060020a033316600081815260056020908152604091829020548251428152925161ffff9091169260008051602061286883398151915292908290030190a3610e9c565b61ffff82166000908152600160208190526040909120015460a860020a900460ff161515610db757610000565b60035b61ffff83166000908152600160208190526040909120015460a060020a900460ff166003811115610de757fe5b1415610df257610000565b80610dfe576001610e01565b60025b61ffff8316600090815260016020819052604090912001805460a060020a60ff02191660a060020a836003811115610e3557fe5b0217905550600160a060020a03331660009081526005602090815260409182902054825184151581524292810192909252825161ffff808716949216927f955f9cd413b1613b572ff1877b25ae515763d2a51d926bd21ba78d8ec4f16c3c92908290030190a35b5b5050565b610ea961272d565b6004805480602002602001604051908101604052809291908181526020018280548015610f1d57602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff1681526020019060020190602082600101049283019260010382029150808411610ee45790505b505050505090505b90565b610f3061272d565b61ffff821660009081526003602052604090206004015460ff161515610f5557610000565b61ffff821660009081526003602090815260409182902060020180548351818402810184019094528084529091830182828015610fd957602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff1681526020019060020190602082600101049283019260010382029150808411610fa05790505b505050505090505b919050565b6004545b90565b60025b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff16600381111561103257fe5b1480611080575060035b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff16600381111561107e57fe5b145b15611340576001608060020a03811615806110b2575061ffff831660009081526003602052604090206004015460ff16155b806110dc575061ffff82166000908152600160208190526040909120015460a860020a900460ff16155b156110e657610000565b61ffff80841660009081526003602081815260408084209487168452939091019052908120905b600291828204019190066010025b905461ffff858116600090815260036020818152604080842094891684529390910190529081206101009390930a9091046001608060020a03169183915b600291828204019190066010025b9054906101000a90046001608060020a0316016001608060020a0316101561118e57610000565b61ffff80841660009081526003602081815260408084209487168452939091019052908120905b600291828204019190066010025b90546001608060020a036101009290920a900416158015611229575061ffff808416600090815260036020818152604080842094871684529390910190522060015b600291828204019190066010025b90546001608060020a036101009290920a900416155b156112875761ffff8316600090815260036020526040902060020180546001810161125483826127a3565b91600052602060002090601091828204019190066002025b815461ffff8087166101009390930a92830292021916179055505b61ffff8084166000908152600360208181526040808420948716845293909101905290812082915b600291828204019190066010025b81546001608060020a036101009290920a8082048316909401821684029382021916929092179055600160a060020a03331660009081526005602090815260409182902054825193851684524291840191909152815161ffff8088169487821694939091169260008051602061282883398151915292918290030190a45b611383565b600160a060020a033316600081815260056020908152604091829020548251428152925161ffff9091169260008051602061286883398151915292908290030190a35b505050565b61139061272d565b6002805480602002602001604051908101604052809291908181526020018280548015610f1d57602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff1681526020019060020190602082600101049283019260010382029150808411610ee45790505b505050505090505b90565b600060025b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff16600381111561145657fe5b14806114a4575060035b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff1660038111156114a257fe5b145b15610cb0575060065461ffff620100009091041660009081526003602052604090208054608060020a80850481028187046001608060020a0319938416176001608060020a03161783556001808401805492860492909316919091179091556004808301805460ff19168317905580549091810161152283826127a3565b91600052602060002090601091828204019190066002025b6006805483546101009390930a61ffff620100009283900481168202918102199094161790935554600160a060020a0333166000908152600560209081526040918290205482516001815242928101929092528251959093048416955091909216927f1f6540b99f70a62641d39a080ec69b8a1442f4a4019da09b6bb25ae3d7d7621c929181900390910190a360068054600161ffff62010000808404821692909201160263ffff0000199091161790555b610a03565b600160a060020a033316600081815260056020908152604091829020548251428152925161ffff9091169260008051602061286883398151915292908290030190a35b50505050565b611642612751565b61ffff831660009081526003602052604090206004015460ff161580611687575061ffff82166000908152600160208190526040909120015460a860020a900460ff16155b1561169157610000565b61ffff83811660009081526003602081815260408084209487168452939091019052818120825180840193849052929091600291908390855b82829054906101000a90046001608060020a03166001608060020a031681526020019060100190602082600f010492830192600103820291508084116116ca5790505b505050505090505b92915050565b60025b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff16600381111561176057fe5b14806117ae575060035b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff1660038111156117ac57fe5b145b15610cb05761ffff841660009081526003602052604090206004015460ff1615156117d857610000565b61ffff80851660008181526003602090815260408083208054608060020a808a048102818c046001608060020a0319938416176001608060020a03161783556001909201805492890492909116919091179055600160a060020a03331683526005825280832054815193845242928401929092528051939491909116927f1f6540b99f70a62641d39a080ec69b8a1442f4a4019da09b6bb25ae3d7d7621c9281900390910190a35b610a03565b600160a060020a033316600081815260056020908152604091829020548251428152925161ffff9091169260008051602061286883398151915292908290030190a35b50505050565b60025b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff16600381111561191357fe5b1480611961575060035b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff16600381111561195f57fe5b145b1561134057600160a060020a038216151561197b57610000565b60408051608081018252848152600160a060020a0384166020820152908101826119a65760016119a9565b60025b60038111156119b457fe5b81526001602091820181905260065461ffff1660009081528183526040908190208451815592840151918301805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a039093169290921780835590840151919060a060020a60ff02191660a060020a836003811115611a2c57fe5b0217905550606091909101516001918201805491151560a860020a0275ff00000000000000000000000000000000000000000019909216919091179055600654600160a060020a0384166000908152600560205260409020805461ffff191661ffff9092169190911790556002805490918101611aa983826127a3565b91600052602060002090601091828204019190066002025b60068054835461ffff6101009490940a848102199091169184160217909255905433600160a060020a031660009081526005602090815260409182902054825160018152429281019290925282519385169550909316927f7107c2ae9754688147920c7dbf25c81ed808624042d38439123c6da5fe34beb4929081900390910190a36006805461ffff8082166001011661ffff199091161790555b611383565b600160a060020a033316600081815260056020908152604091829020548251428152925161ffff9091169260008051602061286883398151915292908290030190a35b505050565b60008080808080808060025b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff166003811115611bf757fe5b1480611c45575060035b33600160a060020a031660009081526005602090815260408083205461ffff168352600191829052909120015460a060020a900460ff166003811115611c4357fe5b145b156126de576001608060020a0389161580611c77575061ffff8a1660009081526003602052604090206004015460ff16155b80611c96575061ffff8a16600090815260036020526040902060020154155b15611ca057610000565b600097508796508695508594505b61ffff8a16600090815260036020526040902060020154851015611def5761ffff8a16600090815260036020819052604082206002810180549190920192919088908110611cf857fe5b90600052602060002090601091828204019190066002025b905461ffff6101009290920a900416815260208101919091526040016000908120905b600291828204019190066010025b905461ffff8c16600090815260036020819052604082206002810180546101009690960a9094046001608060020a03169c909c019b019290919088908110611d8557fe5b90600052602060002090601091828204019190066002025b905461ffff6101009290920a9004168152602081019190915260400160002060015b600291828204019190066010025b9054906101000a90046001608060020a0316870196505b600190940193611cae565b600094506000886001608060020a031611156121bf57600094505b61ffff8a166000908152600360205260409020600201548510156121bf5761ffff8a166000908152600360205260409020600201805486908110611e4a57fe5b90600052602060002090601091828204019190066002025b905461ffff8c811660009081526003602081815260408084206101009790970a90950490931680835294019091529081209195505b600291828204019190066010025b905461ffff8c81166000908152600360208181526040808420948b168452939091019052206101009290920a90046001608060020a0316935060015b600291828204019190066010025b9054906101000a90046001608060020a03169150876001608060020a03168984026001608060020a0316811515611f2257fe5b0490506000816001608060020a0316118015611f4757506000836001608060020a0316115b156121b357826001608060020a03168184036001608060020a0316111561203657600160a060020a03331660009081526005602090815260408083205481516001608060020a03881690940384524292840192909252805161ffff808f1694898216949091169260008051602061282883398151915292918290030190a433600160a060020a03166000908152600560209081526040918290205482516001608060020a03871681524292810192909252825161ffff8e81169489821694919093169260008051602061284883398151915292918290030190a495820195948201946000929190910190612101565b600160a060020a03331660009081526005602090815260408083205481516001608060020a03861690940384524292840192909252805161ffff808f1694898216949091169260008051602061282883398151915292918290030190a433600160a060020a03166000908152600560209081526040918290205482516001608060020a03851681524292810192909252825161ffff8e81169489821694919093169260008051602061284883398151915292918290030190a495860195948501949182900391908101905b61ffff808b166000908152600360208181526040808420948916845293909101905290812084915b600291828204019190066010025b81546001608060020a039384166101009290920a91820293909102191691909117905561ffff808b166000908152600360208181526040808420948916845293909101905220829060015b600291828204019190066010025b6101000a8154816001608060020a0302191690836001608060020a031602179055505b5b600190940193611e0a565b5b886001608060020a0316866001608060020a03161015612395576000876001608060020a0316111561239557600094505b61ffff8a166000908152600360205260409020600201548510156123955761ffff8a16600090815260036020526040902060020180548690811061223157fe5b90600052602060002090601091828204019190066002025b905461ffff8c811660009081526003602081815260408084206101009790970a90950490931680835294019091522090945060015b600291828204019190066010025b9054906101000a90046001608060020a03169150866001608060020a0316868a0383026001608060020a03168115156122c157fe5b0490506000816001608060020a031611156123895761ffff808b1660009081526003602081815260408084209489168452939091019052209581019591810191829060015b600291828204019190066010025b81546001608060020a039384166101009290920a9182029184021916179055600160a060020a03331660009081526005602090815260409182902054825193851684524291840191909152815161ffff808f169489821694939091169260008051602061284883398151915292918290030190a45b5b6001909401936121f1565b5b5b5b886001608060020a0316866001608060020a031610156126515761ffff8a166000908152600360205260409020600201805460001981019081106123d857fe5b90600052602060002090601091828204019190066002025b905461ffff8c811660009081526003602081815260408084206101009790970a9095049093168083529401909152908120919550878b0392505b600291828204019190066010025b9054906101000a90046001608060020a03169250806001608060020a0316836001608060020a031611156124cd57600160a060020a03331660009081526005602090815260408083205481516001608060020a038616909403845242928401929092528051958490039561ffff808f1694898216949091169260008051602061282883398151915292918290030190a4612541565b6000836001608060020a0316111561254157600160a060020a03331660009081526005602090815260408083205481516001608060020a03881690940384524292840192909252805161ffff808f1694898216949091169260008051602061282883398151915292918290030190a4600092505b5b61ffff808b166000908152600360208181526040808420948916845293909101905220819060015b600291828204019190066010025b81546001608060020a036101009290920a808204831690940182168402919093021990921691909117905561ffff808b166000908152600360208181526040808420948916845293909101905290812084915b600291828204019190066010025b81546001608060020a039384166101009290920a9182029184021916179055600160a060020a03331660009081526005602090815260409182902054825193851684524291840191909152815161ffff808f169489821694939091169260008051602061284883398151915292918290030190a48895505b886001608060020a0316866001608060020a0316111561267057610000565b600160a060020a0333166000908152600560209081526040918290205482516001608060020a038a1681524292810192909252825161ffff808f16949216927f56b23e5cb3910a046f9a66c3017ae49b4def7ebae1fb08b4adf446b4fd4c47f192908290030190a35b612721565b600160a060020a033316600081815260056020908152604091829020548251428152925161ffff9091169260008051602061286883398151915292908290030190a35b50505050505050505050565b60408051602081019091526000815290565b60408051602081019091526000815290565b6040604051908101604052806002905b6000815260001990910190602001816127615790505090565b6060604051908101604052806003905b6000815260001990910190602001816127615790505090565b81548183558181151161138357600f016010900481600f016010900483600052602060002091820191016113839190612806565b5b505050565b6040604051908101604052806002905b6000815260001990910190602001816127615790505090565b610a0c91905b80821115612820576000815560010161280c565b5090565b905600f3eb50aadbf0d7c57ec5f56ac9bc98188c5eaf05702012ebfe3698cf182ccb4b190acdb2d73a06a0bfaba310bd3d6a1828c500aeab3cbc74168a53e44565c9e008a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651eaa165627a7a72305820792bfe1207a8507d941a87631a062764bee55ad4bff244561e34c4a3e92b8de20029';

		this.contractGas = '4700000';

		this.connected = false;
		this.initialized = false;
		this.lastBlockNumber = 0;

		this.self = this;
	}

	isWeb3Available(){
		if(typeof web3 == "undefined") return false;
		return true;
	}

	init(callback){
		var self = this;

		web3.eth.getAccounts(function(err, accs) {
			if (err != null) {
				callback("There was an error fetching your accounts.");
				return;
			}

			if (accs.length == 0) {
				callback("Couldn't get any accounts! Make sure Metamask is configured correctly.");
				return;
			}
		
			self.accounts = accs;
			self.account = self.accounts[0];
			
			callback();
		});
	}

	deployNewContract(callback) {
		var self = this;

		var obitcoinContract = web3.eth.contract(this.contractAbi);
		this.Obitcoin = obitcoinContract.new(
		{
			from: web3.eth.accounts[0], 
			data: this.contractCompiled, 
			gas: this.contractGas
		}, function (e, contract){
			console.log(e, contract);
			if (typeof contract.address !== 'undefined') {
				console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);

				self.connected = true;

				callback(e, contract.address);
			}
			if(e) callback(e, contract.address);
		});
	}

	connectToContract(address, callback) {

		var obitcoinContract = web3.eth.contract(this.contractAbi);
		
		this.Obitcoin = obitcoinContract.at(address);
		
		var self = this;

		try {
			this.Obitcoin.getContractAddress.call({from: this.account}, function(error, result){
				if(!error){
					if(result==address){
						console.log("Connection successful");
						self.connected = true;
						callback();
					} else {
						callback("Invalid address!");
					}
				}
				else{
					console.error(error);
					callback("There was an error. Reload the page and try again");
				}
			});
		} catch (err){
			callback(err.message);
		}
	}

	isConnected(){
		return this.connected;
	}

	getAccount(){
		return this.account;
	}

	getPools(callback){
		this.Obitcoin.getPools.call({from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getPoolData(pool, callback){
		var self = this;
		this.Obitcoin.getPoolData.call(pool, {from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(item => data.push(self.hex2a(item)));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getPoolParticipants(pool, callback) {
		this.Obitcoin.getPoolParticipants.call(pool, {from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getMembers(callback){
		this.Obitcoin.getMembers.call({from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getMemberBalance(pool, member, callback){
		this.Obitcoin.getMemberBalance.call(pool, member, {from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data, member);
			}
			else
				console.error(error);
		});
	}

	/*getMemberName(member, callback){
		var self = this;
		this.Obitcoin.getMemberName.call(member, {from: this.account}, function(error, result){
			if(!error){
				callback(self.hex2a(result));
			}
			else
				console.error(error);
		});
	}
		
	getMemberAddress(member, callback){
		this.Obitcoin.getMemberAddress.call(member, {from: this.account}, function(error, result){
			if(!error){
				callback(result);
			}
			else
				console.error(error);
		});
	}

	getMemberPermLevel(member, callback){
		this.Obitcoin.getMemberPermLevel.call(member, {from: this.account}, function(error, result){
			if(!error)
				callback(result.valueOf());
			else
				console.error(error);
		});
	}*/

	getMemberDetails(member, callback){
		var self = this;

		this.Obitcoin.getMemberDetails.call(member, {from: this.account}, function(error, result){
			if(!error){
				var data = [3];
				data[0] = self.hex2a(result[0]);
				data[1] = result[1];
				data[2] = result[2].valueOf();

				callback(data);
			}
			else
				console.error(error);
		});
	}

	getWholeMembers(callback){
		var members = [];
		var self = this;
		this.getMembers(function(data){
			if(data.length==0) callback(members);
			for(var i = 0; i<data.length; i++){
				self.getWholeMember(data[i], function(member){
					members.push(member);

					if(members.length == data.length){
						callback(members);
					}
				});

			}
		});
	}

	getWholeMember(id, callback){
		var member = {};
		member.id = Number(id);

		this.getMemberDetails(id, function(result){
			member.name = result[0];
			member.address = result[1];
			member.permissionLevel = result[2];

			callback(member);
		});

		/*this.getMemberName(id, function(result){
			member.name = result;

			if(member.name != undefined && member.address != undefined && member.permissionLevel != undefined) callback(member);
		});
		this.getMemberAddress(id, function(result){
			member.address = result;

			if(member.name != undefined && member.address != undefined && member.permissionLevel != undefined) callback(member);
		});
		this.getMemberPermLevel(id, function(result){
			member.permissionLevel = Number(result);

			if(member.name != undefined && member.address != undefined && member.permissionLevel != undefined) callback(member);
		});*/
	}

	getWholePools(callback){
		var pools = [];
		var self = this;
		this.getPools(function(data){
			if(data.length==0) callback(pools);

			for(var i = 0; i<data.length; i++){
				self.getWholePool(data[i], function(pool){
					pools.push(pool);

					if(pools.length == data.length){
						callback(pools);
					}
				});

			}
		});
	}

	getWholePool(id, callback){
		var self = this;

		var pool = {};
		pool.id = Number(id);
		var stage1=false, stage2=false;

		pool.tokens = new Map();
		pool.slices = new Map();

		this.getPoolData(id, function(result){
			console.log(result);
			pool.name = result[0];
			pool.legalContract = result[1];
			pool.financialReports = result[2];

			stage1=true;

			if(stage1 && stage2) callback(pool);
		});

		this.getPoolParticipants(id, function(result){
			pool.members = [];
			result.forEach(item => pool.members.push(Number(item)));
			
			if(result.length==0 && stage1) callback(pool);

			for(var i=0; i<result.length; i++){
				self.getMemberBalance(id, result[i], function(data, member){
					pool.tokens[Number(member)] = Number(data[0]);
					pool.slices[Number(member)] = Number(data[1]);

					if(result[result.length-1]==member){
						stage2=true;

						if(stage1 && stage2) callback(pool);
					}
				});
			}
		});
	}

	addMember(name, address, isAdmin, callback){
		console.log("Address is "+address);
		this.Obitcoin.addMember(name, address, isAdmin, {from: this.account}, function(error, result){
			if(!error){
				callback(result);
			}
			else
				console.error(error);
		});
	}

	setAdmin(member, admin) {
		this.Obitcoin.setAdmin(member, admin, {from: this.account}, function(error, result){
			if(!error)
				console.log(result);
			else
				console.error(error);
		});
	}

	createDebtPool(name, legalContract, financialReports, callback) {
		this.Obitcoin.createDebtPool(name, legalContract, financialReports, {from: this.account}, function(error, result){
			if(!error)
				callback(result);
			else
				console.error(error);
		});
	}

	updateMember(member, name, address, isAdmin, callback){

		this.Obitcoin.updateMember(member, name, address, isAdmin, {from: this.account}, function(error, result){
			if(!error){
				console.log(result);
				callback(result);
			}
			else
				console.error(error);
		});
	}

	updatePool(pool, name, legalContract, financialReports, callback){
		this.Obitcoin.updateDebtPool(pool, name, legalContract, financialReports, {from: this.account}, function(error, result){
			if(!error){
				console.log(result);
				callback(result);
			}
			else
				console.error(error);
		});
	}

	sendTokens(pools, member, amount, callback){
		this.Obitcoin.sendTokens(pools, member, amount, {from: this.account}, function(error, result){
			if(!error)
				callback(result)
			else
				console.error(error);
		});
	}

	sendTokensBulk(pool, members, amount, callback){
		this.Obitcoin.sendTokensBulk(pool, members, amount, {from: this.account}, function(error, result){
			if(!error)
				callback(result)
			else
				console.error(error);
		});
	}

	buyTokens(pool, amount, callback){
		this.Obitcoin.buyTokens(pool, amount, {from: this.account}, function(error, result){
			if(!error)
				callback(result)
			else
				console.error(error);
		});
	}

	getLastBlockNumber(){
		return this.lastBlockNumber;
	}

	startListeningForEvents(callback){
		var self = this;

		this.lastBlockNumber = web3.eth.getBlockNumber(function(err, result){
			if(err) return;
			self.lastBlockNumber = result;

			self.Obitcoin.getPublishingBlockNumber.call({from: self.account}, function(error, result){

				var events = self.Obitcoin.allEvents({fromBlock: result.valueOf(), toBlock: 'latest'});
				events.watch(function(err, event) {
					if (err) {
						console.log(err)
						return;
					}

					callback(event);
				});

			});
		});

		/*var coinsTransferEvent = this.Obitcoin.CoinsTransfer({}, {fromBlock: 0});
		coinsTransferEvent.watch(function(err, result) {
			if (err) {
				console.log(err)
				return;
			}
			console.log("["+result.args.time.valueOf()+"] sent "+result.args.amount.valueOf()+" from "+result.args.from+" to "+result.args.to);
		});
		
		var coinsPurchaseEvent = this.Obitcoin.CoinsPurchase({}, {fromBlock: 0});
		coinsPurchaseEvent.watch(function(err, result) {
			if (err) {
				console.log(err)
				return;
			}
			console.log("["+result.args.time.valueOf()+"] bought "+result.args.amount.valueOf()+" from "+result.args.from+" to "+result.args.poolIndex+" debt pool");
		});
		
		var poolCreatedEvent = this.Obitcoin.PoolCreated({}, {fromBlock: 0});
		poolCreatedEvent.watch(function(err,result) {
			if(err) {
				console.log(err);
				return;
			}
			console.log("["+result.args.time.valueOf()+"] created pool with index "+result.args.index.valueOf());
		});
		
		var unauthorizedAccessEvent = this.Obitcoin.UnauthorizedAccess({}, {fromBlock: 0});
		unauthorizedAccessEvent.watch(function(err,result) {
			if(err) {
				console.log(err);
				return;
			}
			console.log("["+result.args.time.valueOf()+"] Warning! Unauthorized access from "+result.args.from);
		});
		
		var adminChangedEvent = this.Obitcoin.AdminChanged({}, {fromBlock: 0});
		adminChangedEvent.watch(function(err,result) {
			if(err) {
				console.log(err);
				return;
			}
			console.log("["+result.args.time.valueOf()+"]" + (result.args.added ? "Added" : "Removed") + " admin with address "+result.args.person);
		});*/
		
		
	}

	hex2a(hexx) {
		var hex = hexx.toString();//force conversion
		var str = '';
		var int;
		for (var i = 2; i < hex.length; i += 2){
			int = parseInt(hex.substr(i, 2), 16);
			if(int==0) continue;
			str += String.fromCharCode(int);
		}
		return str;
	}

	bin2string(array){
		var result = "";
		for(var i = 0; i < array.length; ++i){
			result+= (String.fromCharCode(array[i]));
		}
		return result;
	}

}