import { Member } from './member';
import { Pool } from './pool';

declare var web3: any;

export class contractintegration{
	accounts: any[];
	account: any;
	contractAbi: any;
	contractCompiled: any;
	contractGas: any;
	connected: any;
	initialized: any;
	lastBlockNumber: any;
	self: any;

	Obitcoin: any;

	constructor(){
		this.accounts = [];
		this.account = "";

		this.contractAbi = [{"constant":true,"inputs":[{"name":"pool","type":"uint16"}],"name":"getMembersBalance","outputs":[{"name":"","type":"uint128[]"},{"name":"","type":"uint128[]"},{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"pool","type":"uint16"}],"name":"getPoolData","outputs":[{"name":"","type":"bytes16[3]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pools","type":"uint16[]"},{"name":"members","type":"uint16[]"},{"name":"amount","type":"uint128[]"}],"name":"sendTokensBulk","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getContractAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"member","type":"uint16"}],"name":"getMemberDetails","outputs":[{"name":"","type":"bytes32"},{"name":"","type":"address"},{"name":"","type":"uint8"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPublishingBlockNumber","outputs":[{"name":"","type":"uint32"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"member","type":"uint16"},{"name":"name","type":"bytes32"},{"name":"adr","type":"address"},{"name":"isAdmin","type":"bool"}],"name":"updateMember","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"id","type":"uint16"},{"name":"admin","type":"bool"}],"name":"setAdmin","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPools","outputs":[{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"pool","type":"uint16"}],"name":"getPoolParticipants","outputs":[{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPoolCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pool","type":"uint16"},{"name":"member","type":"uint16"},{"name":"amount","type":"uint128"}],"name":"sendTokens","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getMembers","outputs":[{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes16"},{"name":"legalContract","type":"bytes16"},{"name":"financialReports","type":"bytes16"}],"name":"createDebtPool","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"pool","type":"uint16"},{"name":"member","type":"uint16"}],"name":"getMemberBalance","outputs":[{"name":"","type":"uint128[2]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pool","type":"uint16"},{"name":"name","type":"bytes16"},{"name":"legalContract","type":"bytes16"},{"name":"financialReports","type":"bytes16"}],"name":"updateDebtPool","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes32"},{"name":"adr","type":"address"},{"name":"isAdmin","type":"bool"}],"name":"addMember","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pool","type":"uint16"},{"name":"amount","type":"uint128"}],"name":"buyTokens","outputs":[],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"int256"},{"indexed":false,"name":"time","type":"uint256"}],"name":"TokenTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"uint128"},{"indexed":false,"name":"time","type":"uint256"}],"name":"SliceTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"uint128"},{"indexed":false,"name":"time","type":"uint256"}],"name":"TokenPurchase","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"added","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"PoolChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"fromAddress","type":"address"},{"indexed":false,"name":"time","type":"uint256"}],"name":"UnauthorizedAccess","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":false,"name":"added","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"AdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":false,"name":"added","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"PersonChanged","type":"event"}];

		this.contractCompiled = '606060405234156200000d57fe5b5b33600060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555043600660046101000a81548163ffffffff021916908363ffffffff1602179055506001600660006101000a81548161ffff021916908361ffff1602179055506001600660026101000a81548161ffff021916908361ffff1602179055506080604051908101604052807f4f776e65720000000000000000000000000000000000000000000000000000006000191681526020013373ffffffffffffffffffffffffffffffffffffffff168152602001600360038111156200010c57fe5b81526020016001151581525060016000600660009054906101000a900461ffff1661ffff1661ffff1681526020019081526020016000206000820151816000019060001916905560208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160010160146101000a81548160ff02191690836003811115620001bf57fe5b021790555060608201518160010160156101000a81548160ff02191690831515021790555090505060028054806001018281620001fd9190620002e9565b91600052602060002090601091828204019190066002025b600660009054906101000a900461ffff16909190916101000a81548161ffff021916908361ffff16021790555050600660009054906101000a900461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548161ffff021916908361ffff1602179055506006600081819054906101000a900461ffff168092919060010191906101000a81548161ffff021916908361ffff160217905550505b6200034e565b8154818355818115116200032157600f016010900481600f0160109004836000526020600020918201910162000320919062000326565b5b505050565b6200034b91905b80821115620003475760008160009055506001016200032d565b5090565b90565b614191806200035e6000396000f300606060405236156100fa576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806304a385e5146100fc57806305790c081461022f57806323453e2d1461029d57806332a2c5d01461037457806338c5e15a146103c6578063438a5f131461044e57806357091c81146104805780635fd42e4d146104db578063673a2a1f1461050a5780636d8171301461057f5780638eec5d70146106065780639a59b7491461062c5780639eab525314610678578063a5f97554146106ed578063a97bd3fe14610758578063cee11e96146107d3578063e1669f171461084b578063f3fa89df14610899575bfe5b341561010457fe5b61011e600480803561ffff169060200190919050506108d8565b60405180806020018060200180602001848103845287818151815260200191508051906020019060200280838360008314610178575b80518252602083111561017857602082019150602081019050602083039250610154565b5050509050018481038352868181518152602001915080519060200190602002808383600083146101c8575b8051825260208311156101c8576020820191506020810190506020830392506101a4565b505050905001848103825285818151815260200191508051906020019060200280838360008314610218575b805182526020831115610218576020820191506020810190506020830392506101f4565b505050905001965050505050505060405180910390f35b341561023757fe5b610251600480803561ffff16906020019091905050610c6b565b604051808260036020028083836000831461028b575b80518252602083111561028b57602082019150602081019050602083039250610267565b50505090500191505060405180910390f35b34156102a557fe5b6103726004808035906020019082018035906020019080806020026020016040519081016040528093929190818152602001838360200280828437820191505050505050919080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509190803590602001908201803590602001908080602002602001604051908101604052809392919081815260200183836020028082843782019150505050505091905050610df1565b005b341561037c57fe5b610384610ed7565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156103ce57fe5b6103e8600480803561ffff16906020019091905050610ee0565b6040518084600019166000191681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200182600381111561043857fe5b60ff168152602001935050505060405180910390f35b341561045657fe5b61045e610fb5565b604051808263ffffffff1663ffffffff16815260200191505060405180910390f35b341561048857fe5b6104d9600480803561ffff169060200190919080356000191690602001909190803573ffffffffffffffffffffffffffffffffffffffff169060200190919080351515906020019091905050610fd0565b005b34156104e357fe5b610508600480803561ffff169060200190919080351515906020019091905050611493565b005b341561051257fe5b61051a611743565b604051808060200182810382528381815181526020019150805190602001906020028083836000831461056c575b80518252602083111561056c57602082019150602081019050602083039250610548565b5050509050019250505060405180910390f35b341561058757fe5b6105a1600480803561ffff169060200190919050506117ca565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146105f3575b8051825260208311156105f3576020820191506020810190506020830392506105cf565b5050509050019250505060405180910390f35b341561060e57fe5b6106166118a6565b6040518082815260200191505060405180910390f35b341561063457fe5b610676600480803561ffff1690602001909190803561ffff169060200190919080356fffffffffffffffffffffffffffffffff169060200190919050506118b4565b005b341561068057fe5b610688611ef5565b60405180806020018281038252838181518152602001915080519060200190602002808383600083146106da575b8051825260208311156106da576020820191506020810190506020830392506106b6565b5050509050019250505060405180910390f35b34156106f557fe5b61075660048080356fffffffffffffffffffffffffffffffff19169060200190919080356fffffffffffffffffffffffffffffffff19169060200190919080356fffffffffffffffffffffffffffffffff1916906020019091905050611f7c565b005b341561076057fe5b610787600480803561ffff1690602001909190803561ffff16906020019091905050612396565b60405180826002602002808383600083146107c1575b8051825260208311156107c15760208201915060208101905060208303925061079d565b50505090500191505060405180910390f35b34156107db57fe5b610849600480803561ffff169060200190919080356fffffffffffffffffffffffffffffffff19169060200190919080356fffffffffffffffffffffffffffffffff19169060200190919080356fffffffffffffffffffffffffffffffff19169060200190919050506124c9565b005b341561085357fe5b61089760048080356000191690602001909190803573ffffffffffffffffffffffffffffffffffffffff16906020019091908035151590602001909190505061287d565b005b34156108a157fe5b6108d6600480803561ffff169060200190919080356fffffffffffffffffffffffffffffffff16906020019091905050612d47565b005b6108e0614069565b6108e8614069565b6108f061407d565b6108f8614069565b610900614069565b60006000600360008961ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff16151561093b57610000565b600360008961ffff1661ffff1681526020019081526020016000206002018054905060405180591061096a5750595b908082528060200260200182016040525b509350600360008961ffff1661ffff168152602001908152602001600020600201805490506040518059106109ad5750595b908082528060200260200182016040525b509250600090505b600360008961ffff1661ffff168152602001908152602001600020600201805490508161ffff161015610bbf57600360008961ffff1661ffff1681526020019081526020016000206002018161ffff16815481101515610a2257fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff169150600360008961ffff1661ffff16815260200190815260200160002060030160008361ffff1661ffff1681526020019081526020016000206000600281101515610a8e57fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff16848261ffff16815181101515610ac957fe5b906020019060200201906fffffffffffffffffffffffffffffffff1690816fffffffffffffffffffffffffffffffff1681525050600360008961ffff1661ffff16815260200190815260200160002060030160008361ffff1661ffff1681526020019081526020016000206001600281101515610b4257fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff16838261ffff16815181101515610b7d57fe5b906020019060200201906fffffffffffffffffffffffffffffffff1690816fffffffffffffffffffffffffffffffff16815250505b80806001019150506109c6565b8383600360008b61ffff1661ffff16815260200190815260200160002060020180805480602002602001604051908101604052809291908181526020018280548015610c5257602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff1681526020019060020190602082600101049283019260010382029150808411610c195790505b505050505090509650965096505b505050509193909250565b610c73614091565b600360008361ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff161515610caa57610000565b606060405190810160405280600360008561ffff1661ffff16815260200190815260200160002060000160009054906101000a9004700100000000000000000000000000000000026fffffffffffffffffffffffffffffffff19166fffffffffffffffffffffffffffffffff19168152602001600360008561ffff1661ffff16815260200190815260200160002060000160109054906101000a9004700100000000000000000000000000000000026fffffffffffffffffffffffffffffffff19166fffffffffffffffffffffffffffffffff19168152602001600360008561ffff1661ffff16815260200190815260200160002060010160009054906101000a9004700100000000000000000000000000000000026fffffffffffffffffffffffffffffffff19166fffffffffffffffffffffffffffffffff191681525090505b919050565b6000600083511480610e04575060008251145b80610e10575060008451145b80610e1d57508251825114155b80610e2a57508351835114155b15610e3457610000565b600090505b82518161ffff16108015610e51575081518161ffff16105b8015610e61575083518161ffff16105b15610ed057610ec2848261ffff16815181101515610e7b57fe5b90602001906020020151848361ffff16815181101515610e9757fe5b90602001906020020151848461ffff16815181101515610eb357fe5b906020019060200201516118b4565b5b8080600101915050610e39565b5b50505050565b60003090505b90565b600060006000600160008561ffff1661ffff16815260200190815260200160002060010160159054906101000a900460ff161515610f1d57610000565b600160008561ffff1661ffff16815260200190815260200160002060000154600160008661ffff1661ffff16815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600160008761ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff169250925092505b9193909250565b6000600660049054906101000a900463ffffffff1690505b90565b60026003811115610fdd57fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16600381111561106157fe5b14806110fb57506003600381111561107557fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff1660038111156110f957fe5b145b156113ec57600160008561ffff1661ffff16815260200190815260200160002060010160159054906101000a900460ff16151561113757610000565b6003600381111561114457fe5b600160008661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16600381111561117b57fe5b141561118657610000565b61ffff60056000600160008861ffff1661ffff16815260200190815260200160002060010160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548161ffff021916908361ffff16021790555083600560008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548161ffff021916908361ffff16021790555082600160008661ffff1661ffff168152602001908152602001600020600001816000191690555081600160008661ffff1661ffff16815260200190815260200160002060010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508061130a57600161130d565b60025b600160008661ffff1661ffff16815260200190815260200160002060010160146101000a81548160ff0219169083600381111561134657fe5b02179055508361ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f7107c2ae9754688147920c7dbf25c81ed808624042d38439123c6da5fe34beb460004260405180831515151581526020018281526020019250505060405180910390a35b61148d565b3373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a35b50505050565b600360038111156114a057fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16600381111561152457fe5b1415156115d0573373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a361173f565b600160008361ffff1661ffff16815260200190815260200160002060010160159054906101000a900460ff16151561160757610000565b6003600381111561161457fe5b600160008461ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16600381111561164b57fe5b141561165657610000565b80611662576001611665565b60025b600160008461ffff1661ffff16815260200190815260200160002060010160146101000a81548160ff0219169083600381111561169e57fe5b02179055508161ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f955f9cd413b1613b572ff1877b25ae515763d2a51d926bd21ba78d8ec4f16c3c834260405180831515151581526020018281526020019250505060405180910390a35b5b5050565b61174b61407d565b60048054806020026020016040519081016040528092919081815260200182805480156117bf57602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff16815260200190600201906020826001010492830192600103820291508084116117865790505b505050505090505b90565b6117d261407d565b600360008361ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff16151561180957610000565b600360008361ffff1661ffff16815260200190815260200160002060020180548060200260200160405190810160405280929190818152602001828054801561189957602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff16815260200190600201906020826001010492830192600103820291508084116118605790505b505050505090505b919050565b600060048054905090505b90565b600260038111156118c157fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16600381111561194557fe5b14806119df57506003600381111561195957fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff1660038111156119dd57fe5b145b15611e4f576000816fffffffffffffffffffffffffffffffff161480611a2e5750600360008461ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff16155b80611a625750600160008361ffff1661ffff16815260200190815260200160002060010160159054906101000a900460ff16155b15611a6c57610000565b600360008461ffff1661ffff16815260200190815260200160002060030160008361ffff1661ffff1681526020019081526020016000206000600281101515611ab157fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681600360008661ffff1661ffff16815260200190815260200160002060030160008561ffff1661ffff1681526020019081526020016000206000600281101515611b3257fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff16016fffffffffffffffffffffffffffffffff161015611b7957610000565b6000600360008561ffff1661ffff16815260200190815260200160002060030160008461ffff1661ffff1681526020019081526020016000206000600281101515611bc057fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16148015611c8757506000600360008561ffff1661ffff16815260200190815260200160002060030160008461ffff1661ffff1681526020019081526020016000206001600281101515611c4a57fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff16145b15611cf357600360008461ffff1661ffff1681526020019081526020016000206002018054806001018281611cbc91906140cc565b91600052602060002090601091828204019190066002025b84909190916101000a81548161ffff021916908361ffff160217905550505b80600360008561ffff1661ffff16815260200190815260200160002060030160008461ffff1661ffff1681526020019081526020016000206000600281101515611d3957fe5b600291828204019190066010025b8282829054906101000a90046fffffffffffffffffffffffffffffffff160192506101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055508261ffff168261ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167ff3eb50aadbf0d7c57ec5f56ac9bc98188c5eaf05702012ebfe3698cf182ccb4b846fffffffffffffffffffffffffffffffff1642604051808381526020018281526020019250505060405180910390a45b611ef0565b3373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a35b505050565b611efd61407d565b6002805480602002602001604051908101604052809291908181526020018280548015611f7157602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff1681526020019060020190602082600101049283019260010382029150808411611f385790505b505050505090505b90565b600060026003811115611f8b57fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16600381111561200f57fe5b14806120a957506003600381111561202357fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff1660038111156120a757fe5b145b156122ef5760036000600660029054906101000a900461ffff1661ffff1661ffff1681526020019081526020016000209050838160000160006101000a8154816fffffffffffffffffffffffffffffffff021916908370010000000000000000000000000000000090040217905550828160000160106101000a8154816fffffffffffffffffffffffffffffffff021916908370010000000000000000000000000000000090040217905550818160010160006101000a8154816fffffffffffffffffffffffffffffffff02191690837001000000000000000000000000000000009004021790555060018160040160006101000a81548160ff021916908315150217905550600480548060010182816121c391906140cc565b91600052602060002090601091828204019190066002025b600660029054906101000a900461ffff16909190916101000a81548161ffff021916908361ffff16021790555050600660029054906101000a900461ffff1661ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f1f6540b99f70a62641d39a080ec69b8a1442f4a4019da09b6bb25ae3d7d7621c60014260405180831515151581526020018281526020019250505060405180910390a36006600281819054906101000a900461ffff168092919060010191906101000a81548161ffff021916908361ffff160217905550505b612390565b3373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a35b50505050565b61239e614106565b600360008461ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff1615806123ff5750600160008361ffff1661ffff16815260200190815260200160002060010160159054906101000a900460ff16155b1561240957610000565b600360008461ffff1661ffff16815260200190815260200160002060030160008361ffff1661ffff1681526020019081526020016000206002806020026040519081016040528092919082600280156124bb576020028201916000905b82829054906101000a90046fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020019060100190602082600f010492830192600103820291508084116124665790505b505050505090505b92915050565b600260038111156124d657fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16600381111561255a57fe5b14806125f457506003600381111561256e57fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff1660038111156125f257fe5b145b156127d657600360008561ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff16151561263057610000565b82600360008661ffff1661ffff16815260200190815260200160002060000160006101000a8154816fffffffffffffffffffffffffffffffff02191690837001000000000000000000000000000000009004021790555081600360008661ffff1661ffff16815260200190815260200160002060000160106101000a8154816fffffffffffffffffffffffffffffffff02191690837001000000000000000000000000000000009004021790555080600360008661ffff1661ffff16815260200190815260200160002060010160006101000a8154816fffffffffffffffffffffffffffffffff0219169083700100000000000000000000000000000000900402179055508361ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f1f6540b99f70a62641d39a080ec69b8a1442f4a4019da09b6bb25ae3d7d7621c60004260405180831515151581526020018281526020019250505060405180910390a35b612877565b3373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a35b50505050565b6002600381111561288a57fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16600381111561290e57fe5b14806129a857506003600381111561292257fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff1660038111156129a657fe5b145b15612ca15760008273ffffffffffffffffffffffffffffffffffffffff1614156129d157610000565b608060405190810160405280846000191681526020018373ffffffffffffffffffffffffffffffffffffffff16815260200182612a0f576001612a12565b60025b6003811115612a1d57fe5b81526020016001151581525060016000600660009054906101000a900461ffff1661ffff1661ffff1681526020019081526020016000206000820151816000019060001916905560208201518160010160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060408201518160010160146101000a81548160ff02191690836003811115612acf57fe5b021790555060608201518160010160156101000a81548160ff021916908315150217905550905050600660009054906101000a900461ffff16600560008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060006101000a81548161ffff021916908361ffff16021790555060028054806001018281612b7591906140cc565b91600052602060002090601091828204019190066002025b600660009054906101000a900461ffff16909190916101000a81548161ffff021916908361ffff16021790555050600660009054906101000a900461ffff1661ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f7107c2ae9754688147920c7dbf25c81ed808624042d38439123c6da5fe34beb460014260405180831515151581526020018281526020019250505060405180910390a36006600081819054906101000a900461ffff168092919060010191906101000a81548161ffff021916908361ffff160217905550505b612d42565b3373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a35b505050565b6000600060006000600060006000600060026003811115612d6457fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff166003811115612de857fe5b1480612e82575060036003811115612dfc57fe5b60016000600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff166003811115612e8057fe5b145b15613fbc576000896fffffffffffffffffffffffffffffffff161480612ed15750600360008b61ffff1661ffff16815260200190815260200160002060040160009054906101000a900460ff16155b80612efd57506000600360008c61ffff1661ffff16815260200190815260200160002060020180549050145b15612f0757610000565b60009750600096506000955060009450600094505b600360008b61ffff1661ffff168152602001908152602001600020600201805490508510156130d557600360008b61ffff1661ffff1681526020019081526020016000206003016000600360008d61ffff1661ffff16815260200190815260200160002060020187815481101515612f9057fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff1661ffff1661ffff1681526020019081526020016000206000600281101515612fd957fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff1688019750600360008b61ffff1661ffff1681526020019081526020016000206003016000600360008d61ffff1661ffff1681526020019081526020016000206002018781548110151561305157fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff1661ffff1661ffff168152602001908152602001600020600160028110151561309a57fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff16870196505b8480600101955050612f1c565b600094506000886fffffffffffffffffffffffffffffffff16111561371a57600094505b600360008b61ffff1661ffff1681526020019081526020016000206002018054905085101561371957600360008b61ffff1661ffff1681526020019081526020016000206002018581548110151561314d57fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff169350600360008b61ffff1661ffff16815260200190815260200160002060030160008561ffff1661ffff16815260200190815260200160002060006002811015156131b957fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff169250600360008b61ffff1661ffff16815260200190815260200160002060030160008561ffff1661ffff168152602001908152602001600020600160028110151561322957fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff169150876fffffffffffffffffffffffffffffffff168984026fffffffffffffffffffffffffffffffff1681151561328557fe5b0490506000816fffffffffffffffffffffffffffffffff161180156132bc57506000836fffffffffffffffffffffffffffffffff16115b1561370b57826fffffffffffffffffffffffffffffffff168184036fffffffffffffffffffffffffffffffff161115613476578961ffff168461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167ff3eb50aadbf0d7c57ec5f56ac9bc98188c5eaf05702012ebfe3698cf182ccb4b866fffffffffffffffffffffffffffffffff1660000342604051808381526020018281526020019250505060405180910390a48961ffff168461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f190acdb2d73a06a0bfaba310bd3d6a1828c500aeab3cbc74168a53e44565c9e0864260405180836fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a4828601955082820191508287019650600092506135fa565b8961ffff168461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167ff3eb50aadbf0d7c57ec5f56ac9bc98188c5eaf05702012ebfe3698cf182ccb4b846fffffffffffffffffffffffffffffffff1660000342604051808381526020018281526020019250505060405180910390a48961ffff168461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f190acdb2d73a06a0bfaba310bd3d6a1828c500aeab3cbc74168a53e44565c9e0844260405180836fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a480830392508082019150808701965080860195505b82600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff168152602001908152602001600020600060028110151561364057fe5b600291828204019190066010025b6101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555081600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff16815260200190815260200160002060016002811015156136c857fe5b600291828204019190066010025b6101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055505b5b84806001019550506130f9565b5b886fffffffffffffffffffffffffffffffff16866fffffffffffffffffffffffffffffffff161015613a09576000876fffffffffffffffffffffffffffffffff161115613a0757600094505b600360008b61ffff1661ffff16815260200190815260200160002060020180549050851015613a0257600360008b61ffff1661ffff168152602001908152602001600020600201858154811015156137ba57fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff169350600360008b61ffff1661ffff16815260200190815260200160002060030160008561ffff1661ffff168152602001908152602001600020600160028110151561382657fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff169150866fffffffffffffffffffffffffffffffff16868a0383026fffffffffffffffffffffffffffffffff1681151561388457fe5b0490506000816fffffffffffffffffffffffffffffffff1611156139f4578082019150808601955081600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff16815260200190815260200160002060016002811015156138f257fe5b600291828204019190066010025b6101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055508961ffff168461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f190acdb2d73a06a0bfaba310bd3d6a1828c500aeab3cbc74168a53e44565c9e0844260405180836fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a45b5b8480600101955050613766565b613a08565b5b5b886fffffffffffffffffffffffffffffffff16866fffffffffffffffffffffffffffffffff161015613ecb57600360008b61ffff1661ffff1681526020019081526020016000206002016001600360008d61ffff1661ffff1681526020019081526020016000206002018054905003815481101515613a8457fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff1693508589039050600360008b61ffff1661ffff16815260200190815260200160002060030160008561ffff1661ffff1681526020019081526020016000206000600281101515613af557fe5b600291828204019190066010025b9054906101000a90046fffffffffffffffffffffffffffffffff169250806fffffffffffffffffffffffffffffffff16836fffffffffffffffffffffffffffffffff161115613c065780830392508961ffff168461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167ff3eb50aadbf0d7c57ec5f56ac9bc98188c5eaf05702012ebfe3698cf182ccb4b846fffffffffffffffffffffffffffffffff1660000342604051808381526020018281526020019250505060405180910390a4613cd7565b6000836fffffffffffffffffffffffffffffffff161115613cd6578961ffff168461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167ff3eb50aadbf0d7c57ec5f56ac9bc98188c5eaf05702012ebfe3698cf182ccb4b866fffffffffffffffffffffffffffffffff1660000342604051808381526020018281526020019250505060405180910390a4600092505b5b80600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff1681526020019081526020016000206001600281101515613d1d57fe5b600291828204019190066010025b8282829054906101000a90046fffffffffffffffffffffffffffffffff160192506101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff16021790555082600360008c61ffff1661ffff16815260200190815260200160002060030160008661ffff1661ffff1681526020019081526020016000206000600281101515613dc657fe5b600291828204019190066010025b6101000a8154816fffffffffffffffffffffffffffffffff02191690836fffffffffffffffffffffffffffffffff1602179055508961ffff168461ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f190acdb2d73a06a0bfaba310bd3d6a1828c500aeab3cbc74168a53e44565c9e0844260405180836fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a48895505b886fffffffffffffffffffffffffffffffff16866fffffffffffffffffffffffffffffffff161115613efc57610000565b8961ffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f56b23e5cb3910a046f9a66c3017ae49b4def7ebae1fb08b4adf446b4fd4c47f1884260405180836fffffffffffffffffffffffffffffffff166fffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390a35b61405d565b3373ffffffffffffffffffffffffffffffffffffffff16600560003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060009054906101000a900461ffff1661ffff167f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea426040518082815260200191505060405180910390a35b50505050505050505050565b602060405190810160405280600081525090565b602060405190810160405280600081525090565b6060604051908101604052806003905b60006fffffffffffffffffffffffffffffffff19168152602001906001900390816140a15790505090565b81548183558181151161410157600f016010900481600f016010900483600052602060002091820191016141009190614140565b5b505050565b6040604051908101604052806002905b60006fffffffffffffffffffffffffffffffff168152602001906001900390816141165790505090565b61416291905b8082111561415e576000816000905550600101614146565b5090565b905600a165627a7a72305820aab5080dce54c345c49e8e14baf70d07723c8d8f8dbb805fa1bf25fbcd25ad620029';

		this.contractGas = '4700000';

		this.connected = false;
		this.initialized = false;
		this.lastBlockNumber = 0;

		this.self = this;
	}

	isWeb3Available(){
		if(typeof web3 == "undefined") return false;
		return true;
	}

	init(callback){
		var self = this;

		web3.eth.getAccounts(function(err, accs) {
			if (err != null) {
				callback("There was an error fetching your accounts.");
				return;
			}

			if (accs.length == 0) {
				callback("Couldn't get any accounts! Make sure Metamask is configured correctly.");
				return;
			}
		
			self.accounts = accs;
			self.account = self.accounts[0];
			
			callback();
		});
	}

	deployNewContract(callback) {
		var self = this;

		var obitcoinContract = web3.eth.contract(this.contractAbi);
		this.Obitcoin = obitcoinContract.new(
		{
			from: web3.eth.accounts[0], 
			data: this.contractCompiled, 
			gas: this.contractGas
		}, function (e, contract){
			console.log(e, contract);
			if (typeof contract.address !== 'undefined') {
				console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);

				self.connected = true;

				callback(e, contract.address);
			}
			if(e) callback(e, contract.address);
		});
	}

	connectToContract(address, callback) {

		var obitcoinContract = web3.eth.contract(this.contractAbi);
		
		this.Obitcoin = obitcoinContract.at(address);
		
		var self = this;

		try {
			this.Obitcoin.getContractAddress.call({from: this.account}, function(error, result){
				if(!error){
					if(result==address){
						console.log("Connection successful");
						self.connected = true;
						callback();
					} else {
						callback("Invalid address!");
					}
				}
				else{
					console.error(error);
					callback("There was an error. Reload the page and try again");
				}
			});
		} catch (err){
			callback(err.message);
		}
	}

	isConnected(){
		return this.connected;
	}

	getAccount(){
		return this.account;
	}

	getPools(callback){
		this.Obitcoin.getPools.call({from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getPoolData(pool, callback){
		var self = this;
		this.Obitcoin.getPoolData.call(pool, {from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(item => data.push(self.hex2a(item)));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getPoolParticipants(pool, callback) {
		this.Obitcoin.getPoolParticipants.call(pool, {from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getMembers(callback){
		this.Obitcoin.getMembers.call({from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getMemberBalance(pool, member, callback){
		this.Obitcoin.getMemberBalance.call(pool, member, {from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data, member);
			}
			else
				console.error(error);
		});
	}

	getMembersBalance(pool: Number, callback: Function){
		this.Obitcoin.getMembersBalance.call(pool, {from: this.account}, function(error, result){
			if(!error){
				console.log(result);
				var members = [];
				var tokens = [];
				var slices = [];
				if(result[0].length != result[1].length || result[1].length != result[2].length) console.log("Received corrupt data on getMembersBalance("+pool+")");

				for(var i = 0; i<result[0].length; i++){
					tokens[i] = Number(result[0][i].valueOf());
					slices[i] = Number(result[1][i].valueOf());
					members[i] = Number(result[2][i].valueOf());
				}

				callback(members, tokens, slices);
			} else console.log(error);
		});
	}

	/*getMemberName(member, callback){
		var self = this;
		this.Obitcoin.getMemberName.call(member, {from: this.account}, function(error, result){
			if(!error){
				callback(self.hex2a(result));
			}
			else
				console.error(error);
		});
	}
		
	getMemberAddress(member, callback){
		this.Obitcoin.getMemberAddress.call(member, {from: this.account}, function(error, result){
			if(!error){
				callback(result);
			}
			else
				console.error(error);
		});
	}

	getMemberPermLevel(member, callback){
		this.Obitcoin.getMemberPermLevel.call(member, {from: this.account}, function(error, result){
			if(!error)
				callback(result.valueOf());
			else
				console.error(error);
		});
	}*/

	getMemberDetails(member: Number, callback: Function){
		var self = this;

		this.Obitcoin.getMemberDetails.call(member, {from: this.account}, function(error, result){
			if(!error){
				var data = new Array(3);
				data[0] = self.hex2a(result[0]);
				data[1] = result[1];
				data[2] = result[2].valueOf();

				callback(data);
			}
			else
				console.error(error);
		});
	}

	getWholeMembers(callback: Function){
		var members = [];
		var self = this;
		this.getMembers(function(data){
			if(data.length==0) callback(members);
			for(var i = 0; i<data.length; i++){
				self.getWholeMember(data[i], function(member: Member){
					members.push(member);

					if(members.length == data.length){
						callback(members);
					}
				});

			}
		});
	}

	getWholeMember(id: Number, callback: Function){
		var member = new Member();
		member.id = Number(id);

		this.getMemberDetails(id, function(result){
			member.name = result[0];
			member.address = result[1];
			member.permissionLevel = result[2];

			callback(member);
		});

		/*this.getMemberName(id, function(result){
			member.name = result;

			if(member.name != undefined && member.address != undefined && member.permissionLevel != undefined) callback(member);
		});
		this.getMemberAddress(id, function(result){
			member.address = result;

			if(member.name != undefined && member.address != undefined && member.permissionLevel != undefined) callback(member);
		});
		this.getMemberPermLevel(id, function(result){
			member.permissionLevel = Number(result);

			if(member.name != undefined && member.address != undefined && member.permissionLevel != undefined) callback(member);
		});*/
	}

	getWholePools(callback: Function){
		var pools = [];
		var self = this;
		this.getPools(function(data: Number[]){
			if(data.length==0) callback(pools);

			for(var i = 0; i<data.length; i++){
				self.getWholePool(data[i], function(pool: Pool){
					pools.push(pool);

					if(pools.length == data.length){
						callback(pools);
					}
				});

			}
		});
	}

	getWholePool(id: Number, callback: Function){
		var self = this;

		var pool = new Pool();
		pool.id = Number(id);
		var stage1=false, stage2=false;

		pool.tokens = new Map<number, number>();
		pool.slices = new Map<number, number>();

		this.getPoolData(id, function(result: string[]){
			pool.name = result[0];
			pool.legalContract = result[1];
			pool.financialReports = result[2];

			stage1=true;

			if(stage1 && stage2) callback(pool);
		});

		this.getMembersBalance(id, function(members: number[], tokens: number[], slices: number){
			console.log("Member/token/slices :", members, tokens, slices);
			pool.members = members;

			for(var i = 0; i<members.length; i++){
				pool.tokens[members[i]] = tokens[i];
				pool.slices[members[i]] = slices[i];
			}

			stage2 = true;

			if(stage2 && stage1) callback(pool);
		});
	}

	addMember(name, address, isAdmin, callback){
		console.log("Address is "+address);
		this.Obitcoin.addMember(name, address, isAdmin, {from: this.account}, function(error, result){
			if(!error){
				callback(result);
			}
			else
				console.error(error);
		});
	}

	setAdmin(member, admin) {
		this.Obitcoin.setAdmin(member, admin, {from: this.account}, function(error, result){
			if(!error)
				console.log(result);
			else
				console.error(error);
		});
	}

	createDebtPool(name, legalContract, financialReports, callback) {
		this.Obitcoin.createDebtPool(name, legalContract, financialReports, {from: this.account}, function(error, result){
			if(!error)
				callback(result);
			else
				console.error(error);
		});
	}

	updateMember(member, name, address, isAdmin, callback){

		this.Obitcoin.updateMember(member, name, address, isAdmin, {from: this.account}, function(error, result){
			if(!error){
				console.log(result);
				callback(result);
			}
			else
				console.error(error);
		});
	}

	updatePool(pool, name, legalContract, financialReports, callback){
		this.Obitcoin.updateDebtPool(pool, name, legalContract, financialReports, {from: this.account}, function(error, result){
			if(!error){
				console.log(result);
				callback(result);
			}
			else
				console.error(error);
		});
	}

	sendTokens(pools, member, amount, callback){
		this.Obitcoin.sendTokens(pools, member, amount, {from: this.account}, function(error, result){
			if(!error)
				callback(result)
			else
				console.error(error);
		});
	}

	sendTokensBulk(pool, members, amount, callback){
		this.Obitcoin.sendTokensBulk(pool, members, amount, {from: this.account}, function(error, result){
			if(!error)
				callback(result)
			else
				console.error(error);
		});
	}

	buyTokens(pool, amount, callback){
		this.Obitcoin.buyTokens(pool, amount, {from: this.account}, function(error, result){
			if(!error)
				callback(result)
			else
				console.error(error);
		});
	}

	getLastBlockNumber(){
		return this.lastBlockNumber;
	}

	startListeningForEvents(callback){
		var self = this;

		this.lastBlockNumber = web3.eth.getBlockNumber(function(err, result){
			if(err) return;
			self.lastBlockNumber = result;

			self.Obitcoin.getPublishingBlockNumber.call({from: self.account}, function(error, result){

				var events = self.Obitcoin.allEvents({fromBlock: result.valueOf(), toBlock: 'latest'});
				events.watch(function(err, event) {
					if (err) {
						console.log(err)
						return;
					}

					callback(event);
				});

			});
		});

		/*var coinsTransferEvent = this.Obitcoin.CoinsTransfer({}, {fromBlock: 0});
		coinsTransferEvent.watch(function(err, result) {
			if (err) {
				console.log(err)
				return;
			}
			console.log("["+result.args.time.valueOf()+"] sent "+result.args.amount.valueOf()+" from "+result.args.from+" to "+result.args.to);
		});
		
		var coinsPurchaseEvent = this.Obitcoin.CoinsPurchase({}, {fromBlock: 0});
		coinsPurchaseEvent.watch(function(err, result) {
			if (err) {
				console.log(err)
				return;
			}
			console.log("["+result.args.time.valueOf()+"] bought "+result.args.amount.valueOf()+" from "+result.args.from+" to "+result.args.poolIndex+" debt pool");
		});
		
		var poolCreatedEvent = this.Obitcoin.PoolCreated({}, {fromBlock: 0});
		poolCreatedEvent.watch(function(err,result) {
			if(err) {
				console.log(err);
				return;
			}
			console.log("["+result.args.time.valueOf()+"] created pool with index "+result.args.index.valueOf());
		});
		
		var unauthorizedAccessEvent = this.Obitcoin.UnauthorizedAccess({}, {fromBlock: 0});
		unauthorizedAccessEvent.watch(function(err,result) {
			if(err) {
				console.log(err);
				return;
			}
			console.log("["+result.args.time.valueOf()+"] Warning! Unauthorized access from "+result.args.from);
		});
		
		var adminChangedEvent = this.Obitcoin.AdminChanged({}, {fromBlock: 0});
		adminChangedEvent.watch(function(err,result) {
			if(err) {
				console.log(err);
				return;
			}
			console.log("["+result.args.time.valueOf()+"]" + (result.args.added ? "Added" : "Removed") + " admin with address "+result.args.person);
		});*/
		
		
	}

	hex2a(hexx) {
		var hex = hexx.toString();//force conversion
		var str = '';
		var int;
		for (var i = 2; i < hex.length; i += 2){
			int = parseInt(hex.substr(i, 2), 16);
			if(int==0) continue;
			str += String.fromCharCode(int);
		}
		return str;
	}

	bin2string(array){
		var result = "";
		for(var i = 0; i < array.length; ++i){
			result+= (String.fromCharCode(array[i]));
		}
		return result;
	}

}