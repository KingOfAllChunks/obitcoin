import { Injectable } from '@angular/core';

import { Member } from './member';
import { Pool } from './pool';
import { Vote } from './vote';

declare var web3: any;

@Injectable()

export class contractintegration{
	accounts: any[];
	account: any;
	contractAbi: any;
	contractCompiled: any;
	contractGas: any;
	connected: any;
	initialized: any;
	lastBlockNumber: any;
	self: any;

	events: any;

	Obitcoin: any;

	constructor(){
		this.accounts = [];
		this.account = "";

		this.contractAbi = [{"constant":true,"inputs":[],"name":"getVotesLength","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"voteIndex","type":"uint16"}],"name":"getVote","outputs":[{"name":"","type":"uint8"},{"name":"","type":"uint16"},{"name":"","type":"uint16[]"},{"name":"","type":"int256[]"},{"name":"","type":"uint16"},{"name":"","type":"uint8"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"","type":"uint256"},{"name":"voted","type":"bool[]"},{"name":"poolMembers","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[{"name":"pool","type":"uint16"}],"name":"getPool","outputs":[{"name":"","type":"bytes16[3]"},{"name":"","type":"uint16[]"},{"name":"","type":"uint128[3][]"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getContractAddress","outputs":[{"name":"","type":"address"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPublishingBlockNumber","outputs":[{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"member","type":"uint16"},{"name":"name","type":"bytes32"},{"name":"adr","type":"address"},{"name":"isAdmin","type":"bool"}],"name":"updateMember","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getPools","outputs":[{"name":"","type":"uint16[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pool","type":"uint16"},{"name":"toMembers","type":"uint16[]"},{"name":"amount","type":"int256[]"}],"name":"sendTokens","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getMembers","outputs":[{"name":"","type":"uint16[]"},{"name":"","type":"bytes32[]"},{"name":"","type":"address[]"},{"name":"","type":"uint8[]"}],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes16"},{"name":"legalContract","type":"bytes16"},{"name":"financialReports","type":"bytes16"}],"name":"createDebtPool","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pool","type":"uint16"},{"name":"name","type":"bytes16"},{"name":"legalContract","type":"bytes16"},{"name":"financialReports","type":"bytes16"}],"name":"updateDebtPool","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"voteIndex","type":"uint16"},{"name":"voteFor","type":"bool"}],"name":"vote","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"name","type":"bytes32"},{"name":"adr","type":"address"},{"name":"isAdmin","type":"bool"}],"name":"addMember","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"pool","type":"uint16"},{"name":"amount","type":"uint128"}],"name":"buyTokens","outputs":[],"payable":false,"type":"function"},{"inputs":[],"payable":false,"type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"int256"},{"indexed":false,"name":"time","type":"uint256"}],"name":"TokenTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"uint128"},{"indexed":false,"name":"time","type":"uint256"}],"name":"MoneyTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"int256"},{"indexed":false,"name":"time","type":"uint256"}],"name":"SliceTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"amount","type":"uint128"},{"indexed":false,"name":"time","type":"uint256"}],"name":"TokenPurchase","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"pool","type":"uint16"},{"indexed":false,"name":"added","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"PoolChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"fromAddress","type":"address"},{"indexed":false,"name":"time","type":"uint256"}],"name":"UnauthorizedAccess","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":false,"name":"added","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"AdminChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"to","type":"uint16"},{"indexed":false,"name":"added","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"PersonChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"voteIndex","type":"uint16"},{"indexed":false,"name":"pool","type":"uint16"},{"indexed":false,"name":"voteState","type":"uint8"},{"indexed":false,"name":"time","type":"uint256"}],"name":"VoteChanged","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"uint16"},{"indexed":true,"name":"voteIndex","type":"uint16"},{"indexed":false,"name":"pool","type":"uint16"},{"indexed":false,"name":"vote","type":"bool"},{"indexed":false,"name":"time","type":"uint256"}],"name":"Voted","type":"event"}];

		this.contractCompiled = '606060405234156200000d57fe5b5b60008054600160a060020a03191633600160a060020a039081169190911780835543600955600880546201000061ffff19909116600190811763ffff0000191691909117909155911682526007602090815260408084205461ffff16845260039182905290922001805460a060020a60ff02191674010000000000000000000000000000000000000000835b0217905550600054620000e8907f4f776e657200000000000000000000000000000000000000000000000000000090600160a060020a031660016401000000006200223a6200014682021704565b60008054600160a060020a031681526007602090815260408083205461ffff168352600391829052909120600101805460a060020a60ff02191674010000000000000000000000000000000000000000835b02179055505b620004f8565b60025b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015474010000000000000000000000000000000000000000900460ff16908111156200019e57fe5b148062000200575060035b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015474010000000000000000000000000000000000000000900460ff1690811115620001fe57fe5b145b156200043d57600160a060020a03821615156200021d5762000000565b600160a060020a03821660009081526007602052604090205461ffff1615620002465762000000565b60408051608081018252848152600160a060020a0384166020820152908101826200027357600162000276565b60025b60038111156200028257fe5b81526001602091820181905260085461ffff166000908152600380845260409182902085518155938501519284018054600160a060020a031916600160a060020a039094169390931780845591850151929160a060020a60ff02191690740100000000000000000000000000000000000000009084908111156200030257fe5b0217905550606091909101516001918201805491151575010000000000000000000000000000000000000000000260a860020a60ff0219909216919091179055600854600160a060020a0384166000908152600760205260409020805461ffff191661ffff909216919091179055600480549091810162000384838262000497565b91600052602060002090601091828204019190066002025b60088054835461ffff6101009490940a848102199091169184160217909255905433600160a060020a031660009081526007602090815260409182902054825160018152429281019290925282519385169550909316927f7107c2ae9754688147920c7dbf25c81ed808624042d38439123c6da5fe34beb4929081900390910190a36008805461ffff8082166001011661ffff199091161790555b62000492565b600160a060020a033316600081815260076020908152604091829020548251428152925161ffff909116927f08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651ea92908290030190a35b505050565b8154818355818115116200049257600f016010900481600f01601090048360005260206000209182019101620004929190620004d4565b5b505050565b620004f591905b80821115620004f15760008155600101620004db565b5090565b90565b613f5080620005086000396000f300606060405236156100b45763ffffffff60e060020a600035041663267e652981146100b6578063279be9dd146100d85780632ce126691461029357806332a2c5d0146103a0578063438a5f13146103cc57806357091c81146103ee578063673a2a1f1461041b5780636ccd5bb0146104865780639eab525314610515578063a5f9755414610670578063cee11e961461069b578063d738d4b3146106cd578063e1669f17146106eb578063f3fa89df14610711575bfe5b34156100be57fe5b6100c6610736565b60408051918252519081900360200190f35b34156100e057fe5b6100ef61ffff6004351661073d565b604051808c60028111156100ff57fe5b60ff16815261ffff808d166020830152891660808201526040810190606081019060a00189600281111561012f57fe5b60ff168152602001888152602001878152602001868152602001806020018060200185810385528e818151815260200191508051906020019060200280838360008314610197575b80518252602083111561019757601f199092019160209182019101610177565b50505090500185810384528d8181518152602001915080519060200190602002808383600083146101e3575b8051825260208311156101e357601f1990920191602091820191016101c3565b50505091909101868103845288518152885160209182019250818a019102808383821561022b575b80518252602083111561022b57601f19909201916020918201910161020b565b5050509190910186810383528751815287516020918201925081890191028083838215610273575b80518252602083111561027357601f199092019160209182019101610253565b5050509050019f5050505050505050505050505050505060405180910390f35b341561029b57fe5b6102aa61ffff60043516610aa2565b604051808460608083835b8051825260208311156102d557601f1990920191602091820191016102b5565b5050509050018060200180602001838103835285818151815260200191508051906020019060200280838360008314610329575b80518252602083111561032957601f199092019160209182019101610309565b5050509050018381038252848181518152602001915080516000925b8184101561038c5760208085028401015160608083835b80518252602083111561037c57601f19909201916020918201910161035c565b5050509050019260010192610345565b925050509550505050505060405180910390f35b34156103a857fe5b6103b0610dad565b60408051600160a060020a039092168252519081900360200190f35b34156103d457fe5b6100c6610db2565b60408051918252519081900360200190f35b34156103f657fe5b61041961ffff60043516602435600160a060020a03604435166064351515610db9565b005b341561042357fe5b61042b611146565b6040805160208082528351818301528351919283929083019185810191028083838215610473575b80518252602083111561047357601f199092019160209182019101610453565b5050509050019250505060405180910390f35b341561048e57fe5b6040805160248035600481810135602081810286810182019097528186526104199661ffff84351696939560449501929182919085019084908082843750506040805187358901803560208181028481018201909552818452989a9989019892975090820195509350839250850190849080828437509496506111cd95505050505050565b005b341561051d57fe5b6105256114e6565b604051808060200180602001806020018060200185810385528981815181526020019150805190602001906020028083836000831461057f575b80518252602083111561057f57601f19909201916020918201910161055f565b50505091909101868103855289518152895160209182019250818b01910280838382156105c7575b8051825260208311156105c757601f1990920191602091820191016105a7565b50505091909101868103845288518152885160209182019250818a019102808383821561060f575b80518252602083111561060f57601f1990920191602091820191016105ef565b5050509190910186810383528751815287516020918201925081890191028083838215610657575b80518252602083111561065757601f199092019160209182019101610637565b5050509050019850505050505050505060405180910390f35b341561067857fe5b6104196001608060020a0319600435811690602435811690604435166117d4565b005b34156106a357fe5b61041961ffff600435166001608060020a031960243581169060443581169060643516611a01565b005b34156106d557fe5b61041961ffff600435166024351515611bb6565b005b34156106f357fe5b610419600435600160a060020a0360243516604435151561223a565b005b341561071957fe5b61041961ffff600435166001608060020a036024351661254f565b005b6001545b90565b60006000610749613b77565b610751613b77565b60006000600060006000610763613b77565b61076b613b77565b6000600060018e61ffff1681548110151561078257fe5b906000526020600020906008020160005b50805462010000900461ffff1660009081526005602052604090819020600201549051919350908059106107c45750595b908082528060200260200182016040525b509350600090505b815461ffff62010000909104811660009081526005602052604090206002015490821610156108a257815461ffff62010000909104811660009081526005602081905260408220600201805491860193909190851690811061083b57fe5b90600052602060002090601091828204019190066002025b905461ffff6101009290920a900481168252602082019290925260400160002054855160ff90911691869190841690811061088a57fe5b9115156020928302909101909101525b6001016107dd565b8160000160019054906101000a900460ff168260000160029054906101000a900461ffff1683600101846002018560060160009054906101000a900461ffff168660060160029054906101000a900460ff168760070154886003015489600401548c600560008d60000160029054906101000a900461ffff1661ffff1661ffff168152602001908152602001600020600201888054806020026020016040519081016040528092919081815260200182805480156109a757602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff168152602001906002019060208260010104928301926001038202915080841161096e5790505b50505050509850878054806020026020016040519081016040528092919081815260200182805480156109f957602002820191906000526020600020905b8154815260200190600101908083116109e5575b5050505050975080805480602002602001604051908101604052809291908181526020018280548015610a7357602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff1681526020019060020190602082600101049283019260010382029150808411610a3a5790505b505050505090509c509c509c509c509c509c509c509c509c509c509c505b505091939597999b90929496989a50565b610aaa613bad565b610ab2613b77565b610aba613b77565b610ac2613bad565b610aca613b77565b61ffff861660009081526005602052604081206006015460ff161515610aef57610000565b61ffff871660009081526005602052604090819020600201549051805910610b145750595b908082528060200260200182016040528015610b4a57816020015b610b37613bad565b815260200190600190039081610b2f5790505b5061ffff8816600090815260056020526040812054919350608060020a9091029084905b6001608060020a03199092166020928302919091015261ffff8816600090815260059091526040902054608060020a90819004028360015b6001608060020a03199092166020928302919091015261ffff8816600090815260059091526040902060010154608060020a028360025b6001608060020a031990921660209290920201525060005b61ffff8088166000908152600560205260409020600201549082161015610d025761ffff80881660009081526005602052604081206002810180546003909201939091908516908110610c4457fe5b90600052602060002090601091828204019190066002025b905461ffff6101009290920a90041681526020810191909152604090810160002081516060810190925260038282826020028201916000905b82829054906101000a90046001608060020a03166001608060020a031681526020019060100190602082600f01049283019260010382029150808411610c955790505b5050505050828261ffff16815181101515610cef57fe5b602090810290910101525b600101610bf5565b82600560008961ffff1661ffff1681526020019081526020016000206002018381805480602002602001604051908101604052809291908181526020018280548015610d9557602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff1681526020019060020190602082600101049283019260010382029150808411610d5c5790505b505050505091509550955095505b5050509193909250565b305b90565b6009545b90565b60025b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015460a060020a900460ff1690811115610dff57fe5b1480610e4e575060035b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015460a060020a900460ff1690811115610e4c57fe5b145b156110fd5761ffff841660009081526003602052604090206001015460a860020a900460ff161515610e7f57610000565b60035b61ffff851660009081526003602081905260409091206001015460a060020a900460ff1690811115610eb057fe5b1415610ebb57610000565b600160a060020a03821660009081526007602052604090205461ffff1615610ee257610000565b61ffff84166000818152600360208181526040808420600181018054600160a060020a03908116875260078552838720805461ffff19908116909155908a168088529387208054909116881790559590945291905290859055815473ffffffffffffffffffffffffffffffffffffffff191617905560025b61ffff851660009081526003602081905260409091206001015460a060020a900460ff1690811115610f8857fe5b148015610f93575080155b80610fd4575060015b61ffff851660009081526003602081905260409091206001015460a060020a900460ff1690811115610fca57fe5b148015610fd45750805b5b1561103c57600160a060020a03331660009081526007602090815260409182902054825184151581524292810192909252825161ffff808916949216927f955f9cd413b1613b572ff1877b25ae515763d2a51d926bd21ba78d8ec4f16c3c92908290030190a35b8061104857600161104b565b60025b61ffff851660009081526003602081905260409091206001018054909174ff0000000000000000000000000000000000000000199091169060a060020a90849081111561109457fe5b0217905550600160a060020a03331660009081526007602090815260408083205481519384524292840192909252805161ffff808916949316927f7107c2ae9754688147920c7dbf25c81ed808624042d38439123c6da5fe34beb492908290030190a35b611140565b600160a060020a033316600081815260076020908152604091829020548251428152925161ffff90911692600080516020613ee583398151915292908290030190a35b50505050565b61114e613b77565b60068054806020026020016040519081016040528092919081815260200182805480156111c257602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff16815260200190600201906020826001010492830192600103820291508084116111895790505b505050505090505b90565b60008060035b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015460a060020a900460ff169081111561121657fe5b1461126257600160a060020a033316600081815260076020908152604091829020548251428152925161ffff90911692600080516020613ee583398151915292908290030190a36114de565b8351158061126f57508251155b8061127c57508351835114155b1561128657610000565b61ffff851660009081526005602052604090206006015460ff1615156112ab57610000565b600091505b83518261ffff16101561133c57828261ffff168151811015156112cf57fe5b9060200190602002015160001480611326575060036000858461ffff168151811015156112f857fe5b602090810290910181015161ffff1682528101919091526040016000206001015460ff60a860020a90910416155b1561133057610000565b5b6001909101906112b0565b61ffff8516600090815260056020526040902060020154151561136957611364858585613488565b6114de565b600180549061137a90828101613c11565b5060018054600019810190811061138d57fe5b906000526020600020906008020160005b50805460ff1916600190811780835591925090829061ff001916610100835b02179055506006810180546000919062ff0000191662010000835b0217905550600160a060020a03331660009081526007602081815260409092205460068401805461ffff191661ffff90921691909117905562093a80420190830155845161142e91600184019190870190613c43565b50805463ffff000019166201000061ffff871602178155825161145a9060028301906020860190613cec565b506001546006820154825460405161ffff62010000928390048116808352600019909501811694908416937f716894e2a949e79640a4695695c3c281859348dd862e6ecadede2911af42c67193919291900460ff16904290602081018360028111156114c257fe5b60ff168152602001828152602001935050505060405180910390a35b5b5050505050565b6114ee613b77565b6114f6613b77565b6114fe613b77565b611506613b77565b61150e613b77565b611516613b77565b61151e613b77565b600454604051600091908059106115325750595b908082528060200260200182016040525b50600454604051919550908059106115585750595b908082528060200260200182016040525b506004546040519194509080591061157e5750595b908082528060200260200182016040525b509150600090505b60045461ffff82161015611742576003600060048361ffff168154811015156115bc57fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060000154848261ffff1681518110151561160d57fe5b602090810290910101526004805460039160009161ffff851690811061162f57fe5b90600052602060002090601091828204019190066002025b905461ffff6101009290920a9004811682526020820192909252604001600020600101548451600160a060020a0390911691859190841690811061168757fe5b600160a060020a039092166020928302909101909101526004805460039160009161ffff85169081106116b657fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff1661ffff1661ffff16815260200190815260200160002060010160149054906101000a900460ff16828261ffff1681518110151561171457fe5b90602001906020020190600381111561172957fe5b9081600381111561173657fe5b9052505b600101611597565b6004848484838054806020026020016040519081016040528092919081815260200182805480156117ba57602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff16815260200190600201906020826001010492830192600103820291508084116117815790505b5050505050935097509750975097505b5050505090919293565b600060025b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015460a060020a900460ff169081111561181c57fe5b148061186b575060035b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015460a060020a900460ff169081111561186957fe5b145b156110fd575060085461ffff620100009091041660009081526005602052604090208054608060020a80850481028187046001608060020a0319938416176001608060020a03161783556001808401805492860492909316919091179091556006808301805460ff1916831790558054909181016118e98382613d6e565b91600052602060002090601091828204019190066002025b6008805483546101009390930a61ffff620100009283900481168202918102199094161790935554600160a060020a0333166000908152600760209081526040918290205482516001815242928101929092528251959093048416955091909216927f1f6540b99f70a62641d39a080ec69b8a1442f4a4019da09b6bb25ae3d7d7621c929181900390910190a360088054600161ffff62010000808404821692909201160263ffff0000199091161790555b611140565b600160a060020a033316600081815260076020908152604091829020548251428152925161ffff90911692600080516020613ee583398151915292908290030190a35b50505050565b60025b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015460a060020a900460ff1690811115611a4757fe5b1480611a96575060035b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015460a060020a900460ff1690811115611a9457fe5b145b156110fd5761ffff841660009081526005602052604090206006015460ff161515611ac057610000565b61ffff80851660008181526005602090815260408083208054608060020a808a048102818c046001608060020a0319938416176001608060020a03161783556001909201805492890492909116919091179055600160a060020a03331683526007825280832054815193845242928401929092528051939491909116927f1f6540b99f70a62641d39a080ec69b8a1442f4a4019da09b6bb25ae3d7d7621c9281900390910190a35b611140565b600160a060020a033316600081815260076020908152604091829020548251428152925161ffff90911692600080516020613ee583398151915292908290030190a35b50505050565b6000600060018461ffff16815481101515611bcd57fe5b906000526020600020906008020160005b505462010000900461ffff1660005b61ffff80831660009081526005602052604090206002015490821610156121ef57600160a060020a03331660009081526007602090815260408083205461ffff86811685526005909352922060020180549282169290918416908110611c4f57fe5b90600052602060002090601091828204019190066002025b9054906101000a900461ffff1661ffff1614156121e6576001805461ffff8816908110611c9057fe5b906000526020600020906008020160005b50600160a060020a03331660009081526007602090815260408083205461ffff168084526005850190925290912054919550935060ff1680611cfd575060005b600685015462010000900460ff166002811115611cfa57fe5b14155b15611d0757610000565b61ffff831660009081526005850160205260409020805460ff19166001179055841561200957835461ffff6201000090910481166000908152600560209081526040808320938716835260039093019052908120905b600291828204019190066010025b90546003860180546001608060020a036101009490940a90920492909216019055600160a060020a03331660009081526007602090815260409182902054865483516201000090910461ffff90811682528915159382019390935242818501529251828a169391909216917f935e1ae8eb2b516cef31e554545cf80875084a5190ed424c1bc748ab1de20c989181900360600190a3835462010000900461ffff1660009081526005602052604081206002916004909101905b600291828204019190066010025b9054906101000a90046001608060020a03166001608060020a0316811515611e5657fe5b046001016001608060020a03168460030154101515612004576006840180546001919062ff0000191662010000835b021790555060015b8454610100900460ff166002811115611ea257fe5b1415611f8a57835460018501805460408051602080840282018101909252828152611f8a9462010000900461ffff169390929091830182828015611f2d57602002820191906000526020600020906000905b82829054906101000a900461ffff1661ffff1681526020019060020190602082600101049283019260010382029150808411611ef45790505b505050505086600201805480602002602001604051908101604052809291908181526020018280548015611f8057602002820191906000526020600020905b815481526020019060010190808311611f6c575b5050505050613488565b5b6006840154845460405161ffff620100009283900481168083528a821694918216937f716894e2a949e79640a4695695c3c281859348dd862e6ecadede2911af42c6719391920460ff1690429060208101836002811115611fe857fe5b60ff168152602001828152602001935050505060405180910390a35b6121df565b835461ffff6201000090910481166000908152600560209081526040808320938716835260039093019052908120905b600291828204019190066010025b90546004860180546001608060020a036101009490940a90920492909216019055600160a060020a03331660009081526007602090815260409182902054865483516201000090910461ffff90811682528915159382019390935242818501529251828a169391909216917f935e1ae8eb2b516cef31e554545cf80875084a5190ed424c1bc748ab1de20c989181900360600190a3835462010000900461ffff1660009081526005602052604081206002916004909101905b600291828204019190066010025b9054906101000a90046001608060020a03166001608060020a031681151561213257fe5b046001016001608060020a031684600401541015156121df576006840180546002919062ff0000191662010000835b02179055506006840154845460405161ffff620100009283900481168083528a821694918216937f716894e2a949e79640a4695695c3c281859348dd862e6ecadede2911af42c6719391920460ff16904290602081018360028111156121c357fe5b60ff168152602001828152602001935050505060405180910390a35b5b5b612232565b5b600101611bed565b600160a060020a033316600081815260076020908152604091829020548251428152925161ffff90911692600080516020613ee583398151915292908290030190a35b505050505050565b60025b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015460a060020a900460ff169081111561228057fe5b14806122cf575060035b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015460a060020a900460ff16908111156122cd57fe5b145b1561250757600160a060020a03821615156122e957610000565b600160a060020a03821660009081526007602052604090205461ffff161561231057610000565b60408051608081018252848152600160a060020a03841660208201529081018261233b57600161233e565b60025b600381111561234957fe5b81526001602091820181905260085461ffff16600090815260038084526040918290208551815593850151928401805473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a039094169390931780845591850151929174ff000000000000000000000000000000000000000019169060a060020a9084908111156123d257fe5b0217905550606091909101516001918201805491151560a860020a0275ff00000000000000000000000000000000000000000019909216919091179055600854600160a060020a0384166000908152600760205260409020805461ffff191661ffff909216919091179055600480549091810161244f8382613d6e565b91600052602060002090601091828204019190066002025b60088054835461ffff6101009490940a848102199091169184160217909255905433600160a060020a031660009081526007602090815260409182902054825160018152429281019290925282519385169550909316927f7107c2ae9754688147920c7dbf25c81ed808624042d38439123c6da5fe34beb4929081900390910190a36008805461ffff8082166001011661ffff199091161790555b61254a565b600160a060020a033316600081815260076020908152604091829020548251428152925161ffff90911692600080516020613ee583398151915292908290030190a35b505050565b600080808080808080808060025b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015460a060020a900460ff16908111156125a057fe5b14806125ef575060035b33600160a060020a031660009081526007602090815260408083205461ffff1683526003918290529091206001015460a060020a900460ff16908111156125ed57fe5b145b15613437576001608060020a038b161580612621575061ffff8c1660009081526005602052604090206006015460ff16155b80612640575061ffff8c16600090815260056020526040902060020154155b1561264a57610000565b61ffff8c166000908152600560205260408120600401905b600291828204019190066010025b905461ffff8e1660009081526005602052604090206101009290920a90046001608060020a03169a5060040160015b600291828204019190066010025b905461ffff8e1660009081526005602052604090206101009290920a90046001608060020a0316995060040160025b600291828204019190066010025b9054906101000a90046001608060020a031697506000965060009550886001608060020a03166000141561271d57610000565b60008a6001608060020a03161115612b5857600095505b61ffff8c16600090815260056020526040902060020154861015612b585761ffff8c16600090815260056020526040902060020180548790811061277457fe5b90600052602060002090601091828204019190066002025b905461ffff8e811660009081526005602090815260408083206101009690960a90940490921680825260039094019091529081209196505b600291828204019190066010025b905461ffff8e81166000908152600560209081526040808320938b16835260039093019052206101009290920a90046001608060020a0316945060025b600291828204019190066010025b9054906101000a90046001608060020a03169250896001608060020a03168b85026001608060020a031681151561285057fe5b0491506000826001608060020a03161115612b4c57836001608060020a03168285036001608060020a0316111561298e578b61ffff168561ffff166007600033600160a060020a0316600160a060020a0316815260200190815260200160002060009054906101000a900461ffff1661ffff16600080516020613ec5833981519152876001608060020a031660000342604051808381526020018281526020019250505060405180910390a48b61ffff168561ffff166007600033600160a060020a0316600160a060020a0316815260200190815260200160002060009054906101000a900461ffff1661ffff16600080516020613f05833981519152874260405180836001608060020a03166001608060020a031681526020018281526020019250505060405180910390a4958301956000939290920191612a98565b8b61ffff168561ffff166007600033600160a060020a0316600160a060020a0316815260200190815260200160002060009054906101000a900461ffff1661ffff16600080516020613ec5833981519152856001608060020a031660000342604051808381526020018281526020019250505060405180910390a48b61ffff168561ffff166007600033600160a060020a0316600160a060020a0316815260200190815260200160002060009054906101000a900461ffff1661ffff16600080516020613f05833981519152854260405180836001608060020a03166001608060020a031681526020018281526020019250505060405180910390a4958101959281900392918101915b61ffff808d16600090815260056020908152604080832093891683526003909301905290812085915b600291828204019190066010025b81546001608060020a039384166101009290920a91820293909102191691909117905561ffff808d16600090815260056020908152604080832093891683526003909301905220839060025b600291828204019190066010025b6101000a8154816001608060020a0302191690836001608060020a031602179055505b5b600190950194612734565b5b8a6001608060020a0316876001608060020a03161015612d9a57600095505b61ffff8c16600090815260056020526040902060020154861015612d9a5761ffff8c166000908152600560205260409020600201805487908110612bb857fe5b90600052602060002090601091828204019190066002025b905461ffff8e811660009081526005602090815260408083206101009690960a90940490921680825260039094019091522090955060025b600291828204019190066010025b905461ffff8e81166000908152600560209081526040808320938b16835260039093019052206101009290920a90046001608060020a0316935060015b600291828204019190066010025b9054906101000a90046001608060020a03169050886001608060020a0316878c0382026001608060020a0316811515612c9657fe5b0491506000826001608060020a03161115612d8e5761ffff808d166000908152600560209081526040808320938916835260039093019052209682019692820192839060025b600291828204019190066010025b6101000a8154816001608060020a0302191690836001608060020a031602179055508b61ffff168561ffff166007600033600160a060020a0316600160a060020a0316815260200190815260200160002060009054906101000a900461ffff1661ffff16600080516020613f05833981519152854260405180836001608060020a03166001608060020a031681526020018281526020019250505060405180910390a45b5b600190950194612b78565b5b8a6001608060020a0316876001608060020a031610156130c45761ffff8c16600090815260056020526040902060020180546000198101908110612ddb57fe5b90600052602060002090601091828204019190066002025b905461ffff8e811660009081526005602090815260408083206101009690960a9094049092168082526003909401909152908120919650888d0393505b600291828204019190066010025b9054906101000a90046001608060020a03169350816001608060020a0316846001608060020a03161115612ef15781840393508b61ffff168561ffff166007600033600160a060020a0316600160a060020a0316815260200190815260200160002060009054906101000a900461ffff1661ffff16600080516020613ec5833981519152856001608060020a031660000342604051808381526020018281526020019250505060405180910390a4612f83565b6000846001608060020a03161115612f83578b61ffff168561ffff166007600033600160a060020a0316600160a060020a0316815260200190815260200160002060009054906101000a900461ffff1661ffff16600080516020613ec5833981519152876001608060020a031660000342604051808381526020018281526020019250505060405180910390a4600093505b5b61ffff808d16600090815260056020908152604080832093891683526003909301905220829060025b600291828204019190066010025b81546001608060020a036101009290920a808204831690940182168402919093021990921691909117905561ffff808d16600090815260056020908152604080832093891683526003909301905290812085915b600291828204019190066010025b6101000a8154816001608060020a0302191690836001608060020a031602179055508b61ffff168561ffff166007600033600160a060020a0316600160a060020a0316815260200190815260200160002060009054906101000a900461ffff1661ffff16600080516020613f05833981519152854260405180836001608060020a03166001608060020a031681526020018281526020019250505060405180910390a48a96505b8a6001608060020a0316876001608060020a031611156130e357610000565b600099506000985060009750600095505b61ffff8c166000908152600560205260409020600201548610156132bf5761ffff8c166000908152600560205260408120600281018054600390920192918990811061313c57fe5b90600052602060002090601091828204019190066002025b905461ffff6101009290920a900416815260208101919091526040016000908120905b600291828204019190066010025b905461ffff8e1660009081526005602052604081206002810180546101009590950a9093046001608060020a03169d909d019c60030192909190899081106131c957fe5b90600052602060002090601091828204019190066002025b905461ffff6101009290920a9004168152602081019190915260400160002060015b600291828204019190066010025b905461ffff8e1660009081526005602052604081206002810180546101009590950a9093046001608060020a03169c909c019b600301929091908990811061325557fe5b90600052602060002090601091828204019190066002025b905461ffff6101009290920a9004168152602081019190915260400160002060025b600291828204019190066010025b9054906101000a90046001608060020a0316880197505b6001909501946130f4565b61ffff8c1660009081526005602052604081208b916004909101905b600291828204019190066010025b81546001608060020a039384166101009290920a91820293909102191691909117905561ffff8c166000908152600560205260409020899060040160015b600291828204019190066010025b81546001608060020a039384166101009290920a91820293909102191691909117905561ffff8c166000908152600560205260409020889060040160025b600291828204019190066010025b6101000a8154816001608060020a0302191690836001608060020a031602179055508b61ffff166007600033600160a060020a0316600160a060020a0316815260200190815260200160002060009054906101000a900461ffff1661ffff167f56b23e5cb3910a046f9a66c3017ae49b4def7ebae1fb08b4adf446b4fd4c47f1894260405180836001608060020a03166001608060020a031681526020018281526020019250505060405180910390a35b61347a565b600160a060020a033316600081815260076020908152604091829020548251428152925161ffff90911692600080516020613ee583398151915292908290030190a35b505050505050505050505050565b6000600060008451845114151561349e57610000565b5060005b84518161ffff16101561223257848161ffff168151811015156134c157fe5b906020019060200201519250838161ffff168151811015156134df57fe5b602090810290910181015161ffff8089166000908152600584526040808220928816825260039092019093528220909350905b600291828204019190066010025b905461ffff88811660009081526005602090815260408083209389168352600390930190529081206101009390930a9091046001608060020a03169184915b600291828204019190066010025b9054906101000a90046001608060020a03166001608060020a031601121561359457610000565b61ffff80871660009081526005602090815260408083209387168352600390930190522060015b600291828204019190066010025b905461ffff8881166000908152600560209081526040808320938916835260039093019052206101009290920a90046001608060020a031690839060015b600291828204019190066010025b9054906101000a90046001608060020a03166001608060020a031601121561363c57610000565b61ffff8087166000908152600560209081526040808320938716835260039093019052908120905b600291828204019190066010025b9054906101000a90046001608060020a03166001608060020a031682600003131561369c57610000565b61ffff8087166000908152600560209081526040808320938716835260039093019052908120905b600291828204019190066010025b90546001608060020a036101009290920a900416158015613739575061ffff80871660009081526005602090815260408083209387168352600390930190522060015b600291828204019190066010025b90546001608060020a036101009290920a900416155b156137975761ffff861660009081526005602052604090206002018054600181016137648382613d6e565b91600052602060002090601091828204019190066002025b815461ffff8088166101009390930a92830292021916179055505b60008213156139215761ffff808716600090815260056020908152604080832093871683526003909301905290812083915b600291828204019190066010025b81546001608060020a036101009290920a808204831690940182168402919093021990921691909117905561ffff808716600090815260056020908152604080832093871683526003909301905220829060015b600291828204019190066010025b81546001608060020a036101009290920a808204831690940182168402919093021990921691909117905561ffff8616600090815260056020526040812083916004909101905b600291828204019190066010025b81546001608060020a036101009290920a808204831690940182168402919093021990921691909117905561ffff86166000908152600560205260409020829060040160015b600291828204019190066010025b8282829054906101000a90046001608060020a03160192506101000a8154816001608060020a0302191690836001608060020a03160217905550613aad565b61ffff8087166000908152600560209081526040808320938716835260039093019052908120838203915b600291828204019190066010025b81546001608060020a036101009290920a80820483169490940382168402919093021990921691909117905561ffff8087166000908152600560209081526040808320938716835260039093019052908120908390039060015b600291828204019190066010025b81546001608060020a036101009290920a80820483169490940382168402919093021990921691909117905561ffff86166000908152600560205260408120838203916004909101905b600291828204019190066010025b81546001608060020a036101009290920a80820483169490940382168402919093021990921691909117905561ffff86166000908152600560205260408120908390039060040160015b600291828204019190066010025b8282829054906101000a90046001608060020a03160392506101000a8154816001608060020a0302191690836001608060020a031602179055505b33600160a060020a03166000908152600760209081526040918290205482518581524292810192909252825161ffff8a811694888216949190931692600080516020613ec583398151915292918290030190a433600160a060020a03166000908152600760209081526040918290205482518581524292810192909252825161ffff8a8116948882169491909316927fb9391ec3dd39929885998b0c7d6e055589bf5c1fddbd79099da743a20b82252492918290030190a45b6001016134a2565b5b505050505050565b60408051602081019091526000815290565b60408051602081019091526000815290565b60408051602081019091526000815290565b6060604051908101604052806003905b600081526000199091019060200181613bbd5790505090565b60408051602081019091526000815290565b6060604051908101604052806003905b600081526000199091019060200181613bbd5790505090565b81548183558181151161254a5760080281600802836000526020600020918201910161254a9190613da8565b5b505050565b82805482825590600052602060002090600f01601090048101928215613cdc5791602002820160005b83821115613cac57835183826101000a81548161ffff021916908361ffff1602179055509260200192600201602081600101049283019260010302613c6c565b8015613cda5782816101000a81549061ffff0219169055600201602081600101049283019260010302613cac565b505b50613ce8929150613e11565b5090565b828054828255906000526020600020908101928215613d27579160200282015b82811115613d27578251825591602001919060010190613d0c565b5b50613ce8929150613e37565b5090565b60408051602081019091526000815290565b60408051602081019091526000815290565b60408051602081019091526000815290565b81548183558181151161254a57600f016010900481600f0160109004836000526020600020918201910161254a9190613e37565b5b505050565b61073a91905b80821115613ce857805463ffffffff191681556000613dd06001830182613e79565b613dde600283016000613ea2565b506000600382018190556004820181905560068201805462ffffff191690556007820155600801613dae565b5090565b90565b61073a91905b80821115613ce857805461ffff19168155600101613e17565b5090565b90565b61073a91905b80821115613ce85760008155600101613e3d565b5090565b90565b61073a91905b80821115613ce85760008155600101613e3d565b5090565b90565b50805460008255600f016010900490600052602060002090810190613e9e9190613e37565b5b50565b5080546000825590600052602060002090810190613e9e9190613e37565b5b505600f3eb50aadbf0d7c57ec5f56ac9bc98188c5eaf05702012ebfe3698cf182ccb4b08a520c83f3f94e52d4d4b14319f76c4924f0b58aa571d1d8956acc5849651eacca8dbd4ba5afe4571e9544660d61ec920fc8c397d1ccb89154e803057bde225a165627a7a72305820c94af4d363932a1f47440c78fa854421c236b4aa83b7ec37af212da79b34544b0029';

		this.contractGas = '5000000';

		this.connected = false;
		this.initialized = false;
		this.lastBlockNumber = 0;

		this.self = this;
	}

	isWeb3Available(){
		if(typeof web3 == "undefined") return false;
		return true;
	}

	init(callback){
		var self = this;

		web3.eth.getAccounts(function(err, accs) {
			if (err != null) {
				callback("There was an error fetching your accounts.");
				return;
			}

			if (accs.length == 0) {
				callback("Couldn't get any accounts! Make sure Metamask is configured correctly.");
				return;
			}
		
			self.accounts = accs;
			self.account = self.accounts[0];

			console.log("Extracted accounts: ",self.accounts);
			
			callback();
		});
	}

	deployNewContract(callback) {
		var self = this;

		var obitcoinContract = web3.eth.contract(this.contractAbi);
		this.Obitcoin = obitcoinContract.new(
		{
			from: web3.eth.accounts[0], 
			data: this.contractCompiled, 
			gas: this.contractGas
		}, function (e, contract){
			if(e) callback(e, undefined);
			else if (typeof contract.address !== 'undefined') {
				console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
				console.log(contract);

				self.connected = true;

				callback(e, contract.address);
			}
		});
	}

	connectToContract(address, callback) {

		var obitcoinContract = web3.eth.contract(this.contractAbi);
		
		this.Obitcoin = obitcoinContract.at(address);
		
		var self = this;

		try {
			this.Obitcoin.getContractAddress.call({from: this.account}, function(error, result){
				if(!error){
					if(result==address){
						console.log("Connection successful");
						self.connected = true;
						callback();
					} else {
						callback("Invalid address!");
					}
				}
				else{
					console.error(error);
					callback("There was an error. Reload the page and try again");
				}
			});
		} catch (err){
			callback(err.message);
		}
	}

	disconnect(){
		this.Obitcoin = undefined;
		this.connected = false;
		if(this.events != undefined){
			this.events.stopWatching();
			this.events = undefined;
		}
	}

	isConnected(){
		return this.connected;
	}

	getAccount(){
		return this.account;
	}

	getPools(callback){
		if(!this.isConnected()) return;

		this.Obitcoin.getPools.call({from: this.account}, function(error, result){
			if(!error){
				var data = [];
				result.forEach(res => data.push(res.valueOf()));
				callback(data);
			}
			else
				console.error(error);
		});
	}

	getPool(pool: number, callback: Function){
		if(!this.isConnected()) return;

		var self = this;

		this.Obitcoin.getPool.call(pool, {from: this.account}, function(error, result){
			if(!error){
				if(result[1].length != result[2].length) console.error("Received corrupt data on getPool("+pool+")");

				console.log(result);

				let data : string[] = [];
				let members : number[] = [];
				result[0].forEach(item => data.push(self.hex2a(item)));
				result[1].forEach(res => members.push(res.valueOf()));
				
				let tokens : number[] = [];
				let slices : number[] = [];
				let money : number[] = [];

				for(var i = 0; i<result[2].length; i++){
					tokens[i] = Number(result[2][i][0].valueOf());
					slices[i] = Number(result[2][i][1].valueOf());
					money[i] = Number(result[2][i][2].valueOf());
				}

				callback(data, members, tokens, slices, money);
			}
			else console.error(error);
		});
	}

	getMembers(callback: Function){
		if(!this.isConnected()) return;
		var self = this;

		this.Obitcoin.getMembers.call({from: this.account}, function(error, result){
			if(!error){
				let memberIds : number[] = [];
				let names : string[] = [];
				let addresses : string[] = [];
				let permLevels : number[] = [];

				result[0].forEach(res => memberIds.push(res.valueOf()));
				result[1].forEach(res => names.push(self.hex2a(res)));
				addresses = result[2];
				result[3].forEach(res => permLevels.push(res.valueOf()));

				callback(memberIds, names, addresses, permLevels);
			}
			else
				console.error(error);
		});
	}

	getVotesLength(callback: Function){
		if(!this.isConnected()) return;
		var self = this;

		this.Obitcoin.getVotesLength.call({from: this.account}, function(error, result){
			if(!error){
				callback(result.valueOf());
			} else console.error(error);
		});
	}

	getVote(voteIndex: number, callback: Function){
		if(!this.isConnected()) return;
		var self = this;

		this.Obitcoin.getVote.call(voteIndex, {from: this.account}, function(error, result){
			if(!error){

				console.log(result);
				let vote : Vote = new Vote();
				vote.voteType = Number(result[0].valueOf());
				vote.pool = Number(result[1].valueOf());
				vote.arg1 = [];
				result[2].forEach(res => vote.arg1.push(Number(res.valueOf())));
				vote.arg2 = [];
				result[3].forEach(res => vote.arg2.push(Number(res.valueOf())));
				vote.startedBy = Number(result[4].valueOf());
				vote.voteState = Number(result[5].valueOf());
				vote.endTime = Number(result[6].valueOf());
				vote.votedFor = Number(result[7].valueOf());
				vote.votedAgainst = Number(result[8].valueOf());
				vote.voted = new Map<number, boolean>();
				vote.id = Number(voteIndex);

				for(var i = 0; i<result[9].length; i++){
					vote.voted[result[10][i].valueOf()] = result[9][i].valueOf();
				}

				callback(vote);
			} else console.error(error);
		});
	}

	getWholeVotes(callback: Function){
		var votes : Vote[] = [];
		var self = this;

		console.log("starting to get votes");

		this.getVotesLength(function(length: number){
			if(length == 0) callback(votes);

			for(var i = 0; i<length; i++){
				self.getVote(i, function(vote: Vote){
					votes.push(vote);
					console.log("got vote ",vote, "with length ", length, "and index ", i);
					if(votes.length == length) callback(votes);
				});
			}
		});
	}


	getWholeMembers(callback: Function){
		var members :Member[] = [];
		var self = this;
		this.getMembers(function(memberIds : number[], memberNames : string[], memberAddresses : string[], permLevels : number[]){
			if(memberIds.length==0) callback(members);

			for(var i = 0; i<memberIds.length; i++){
				let member : Member = new Member();

				member.id = memberIds[i];
				member.name = memberNames[i];
				member.address = memberAddresses[i];
				member.permissionLevel = permLevels[i];

				members.push(member);
			}

			callback(members);
		});
	}

	getWholePools(callback: Function){
		var pools: Pool[] = [];
		var self = this;
		this.getPools(function(data: number[]){
			if(data.length==0) callback(pools);

			for(var i = 0; i<data.length; i++){
				self.getWholePool(data[i], function(pool: Pool){
					pools.push(pool);

					if(pools.length == data.length){
						console.log("Loaded pools: ", pools);
						callback(pools);
					}
				});

			}
		});
	}

	getWholePool(id: number, callback: Function){
		var self = this;

		var pool = new Pool();
		pool.id = Number(id);

		pool.tokens = new Map<number, number>();
		pool.slices = new Map<number, number>();
		pool.money = new Map<number, number>();

		this.getPool(id, function(data: string[], members: number[], tokens: number[], slices: number[], money: number[]){
			pool.name = data[0];
			pool.legalContract = data[1];
			pool.financialReports = data[2];

			pool.members = members;

			for(var i = 0; i<members.length; i++){
				pool.tokens[members[i]] = tokens[i];
				pool.slices[members[i]] = slices[i];
				pool.money[members[i]] = money[i];
			}

			callback(pool);		
		});
	}

	addMember(name, address, isAdmin, callback){
		if(!this.isConnected()) return;

		this.Obitcoin.addMember(name, address, isAdmin, {from: this.account}, function(error, result){
			if(!error){
				callback(result);
			}
			else
				console.error(error);
		});
	}

	createDebtPool(name, legalContract, financialReports, callback) {
		if(!this.isConnected()) return;

		this.Obitcoin.createDebtPool(name, legalContract, financialReports, {from: this.account}, function(error, result){
			if(!error)
				callback(result);
			else
				console.error(error);
		});
	}

	updateMember(member, name, address, isAdmin, callback){
		if(!this.isConnected()) return;

		this.Obitcoin.updateMember(member, name, address, isAdmin, {from: this.account}, function(error, result){
			if(!error){
				console.log(result);
				callback(result);
			}
			else
				console.error(error);
		});
	}

	updatePool(pool, name, legalContract, financialReports, callback){
		if(!this.isConnected()) return;

		this.Obitcoin.updateDebtPool(pool, name, legalContract, financialReports, {from: this.account}, function(error, result){
			if(!error){
				console.log(result);
				callback(result);
			}
			else
				console.error(error);
		});
	}

	vote(voteIndex: number, voteFor: boolean, callback: Function){
		if(!this.isConnected()) return;

		this.Obitcoin.vote(voteIndex, voteFor, {from: this.account}, function(error, result){
			if(!error){
				callback(result);
			} else console.error(error);
		});
	}

	sendTokens(pool: number, members: number[], amount: number[], callback: Function){
		if(!this.isConnected()) return;

		this.Obitcoin.sendTokens(pool, members, amount, {from: this.account}, function(error, result){
			if(!error)
				callback(result)
			else
				console.error(error);
		});
	}

	buyTokens(pool, amount, callback){
		if(!this.isConnected()) return;

		this.Obitcoin.buyTokens(pool, amount, {from: this.account}, function(error, result){
			if(!error)
				callback(result)
			else
				console.error(error);
		});
	}

	getLastBlockNumber(){
		return this.lastBlockNumber;
	}

	startListeningForEvents(callback){
		if(!this.isConnected()) return;

		var self = this;

		this.lastBlockNumber = web3.eth.getBlockNumber(function(err, result){
			if(err) return;
			self.lastBlockNumber = result;

			self.Obitcoin.getPublishingBlockNumber.call({from: self.account}, function(error, result){

				self.events = self.Obitcoin.allEvents({fromBlock: result.valueOf()});
				self.events.watch(function(err, event) {
					if (err) {
						console.log(err)
						return;
					}
					callback(event);
				});

			});
		});
	}

	hex2a(hexx) { //convert a byte array to string
		var hex = hexx.toString(); //force conversion
		var str = '';
		var int;
		for (var i = 2; i < hex.length; i += 2){
			int = parseInt(hex.substr(i, 2), 16);
			if(int==0) continue;
			str += String.fromCharCode(int);
		}
		return str;
	}
}